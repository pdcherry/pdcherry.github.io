{
  "hash": "f74dc610a53c5c4d9b1d6893c3293b05",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"GTEX RNA-seq Liver-specific Process and TF Identification\"\nauthor: \"Patrick Cherry\"\ndate: \"2024-01-03\"\ncategories:\n  - code\n  - RNAseq\nimage: \"2024_01_03-GTEX_RNA_seq_liver/2024_01_03-liver_creative_commons.jpg\"\nexecute:\n  freeze: true\n---\n\n# Introduction\nI use the publicly available bulk RNA-Seq data from [GTEX](https://www.gtexportal.org/home/downloads/adult-gtex) (v8) identify biological pathways and processes specific to the liver. I also identify putative transcriptional regulators of these pathways and processes. To ensure that the analysis fits into local memory, I restrict the features in scope to be protein-coding genes, and the  tissues in scope to be the following following: heart, kidney, liver, lung, muscle, pancreas, spleen, stomach, pituitary gland, and thyroid.\n\n## Notes on approach\n[The GTEx Consortium atlas of genetic regulatory effects across human tissues](https://www.science.org/doi/full/10.1126/science.aaz1776) The Genotype-Tissue Expression (GTEx) project was established to characterize genetic effects on the transcriptome across human tissues and to link these regulatory mechanisms to trait and disease associations.\n\nI'm interpreting \"specific to the liver\" to mean uniquely expressed in the liver compared to each other tissue in scope. I will express this in the analysis by running instructing DEseq to run a one-to-many test by ranking liver first among the tissue factors, and then running a p-value meta-analysis on the p-value results for features (protein-coding genes) in all comparisons. (Meaning, it only takes one liver-to-tissue comparison revealing that a gene is NOT up-regulated in the liver to remove that gene from consideration.)\n\n## Patrick's hypothesis\nGiven this is liver RNA-seq, I expect to see genes implicated in the liver main roles, namely:\n\n - conditioning the blood by secreting important proteins into it, like serum albumin, immune complement proteins, C-reactive protein, clotting factors (pre-pro-thrombin, fibrinogen, plasminogen), etc.\n - cytochrome P450 proteins (CYPxxx), by which the liver catabolizes xenobiotics\n - glycolysis, gluconeogenesis, and fatty acid catabolism\n - bile salts catabolism and anabolism (cholesterols, hemoglobin/porphyrin)\n - amino acid conversion and catabolism\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(usethis)\nlibrary(readr)                  # for reading and writing csvs\nlibrary(fs)                     # for filesystem navigation in R\nlibrary(dplyr)                  # for dataframe manipulation\nlibrary(tidyr)                  # for dataframe group nesting and manipulation\nlibrary(purrr)                  # for functional programming, including on nested dataframes\nlibrary(readxl)                 # for reading excel files\nlibrary(stringr)                # for efficient string manipulation\nlibrary(magrittr)               # for enhanced pipes\nlibrary(broom)                  # for model manipulation\nlibrary(forcats)                # for factor manipulation\nlibrary(ggplot2)                # for additional plotting features\nlibrary(ensembldb)\nlibrary(DESeq2)\nlibrary(AnnotationDbi)\nlibrary(org.Hs.eg.db)\nlibrary(gage)\nlibrary(gageData)\nlibrary(pathview)\nlibrary(TFEA.ChIP)              # analyze transcription factor enrichment in a gene set\nlibrary(BiocParallel)           # speed up some parallelizeable processing\nregister(MulticoreParam(4))     # set core parallelization to 4 CPU cores\ntheme_set(theme_bw())           # set the default ggplot theme to be clear & cartooney\n```\n:::\n\n\n# Metadata (sample annotations)\nSamples come from https://github.com/broadinstitute/gtex-v8/blob/master/data/GTEx_Analysis_v8_RNAseq_samples.txt, and have to be manually downloaded.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngtex_samples <- read.delim(\"../../GTEX-liver-parent-dir/GTEx_Analysis_v8_RNAseq_samples.txt\", sep = \"\\t\") %>%\n  mutate(\"sample_id\" = str_replace_all(sample_id, \"-\", \"\\\\.\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngtex_samples %>% dplyr::count(tissue_id) %>% arrange(desc(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                               tissue_id   n\n1                        Muscle_Skeletal 803\n2                            Whole_Blood 755\n3             Skin_Sun_Exposed_Lower_leg 701\n4                   Adipose_Subcutaneous 663\n5                          Artery_Tibial 663\n6                                Thyroid 653\n7                           Nerve_Tibial 619\n8        Skin_Not_Sun_Exposed_Suprapubic 604\n9                                   Lung 578\n10                      Esophagus_Mucosa 555\n11              Adipose_Visceral_Omentum 541\n12                  Esophagus_Muscularis 515\n13            Cells_Cultured_fibroblasts 504\n14                 Breast_Mammary_Tissue 459\n15                          Artery_Aorta 432\n16                  Heart_Left_Ventricle 432\n17                Heart_Atrial_Appendage 429\n18                      Colon_Transverse 406\n19   Esophagus_Gastroesophageal_Junction 375\n20                         Colon_Sigmoid 373\n21                                Testis 361\n22                               Stomach 359\n23                              Pancreas 328\n24                             Pituitary 283\n25                         Adrenal_Gland 258\n26                          Brain_Cortex 255\n27           Brain_Caudate_basal_ganglia 246\n28 Brain_Nucleus_accumbens_basal_ganglia 246\n29                              Prostate 245\n30                      Brain_Cerebellum 241\n31                                Spleen 241\n32                       Artery_Coronary 240\n33                                 Liver 226\n34           Brain_Cerebellar_Hemisphere 215\n35              Brain_Frontal_Cortex_BA9 209\n36           Brain_Putamen_basal_ganglia 205\n37                    Brain_Hypothalamus 202\n38                     Brain_Hippocampus 197\n39        Small_Intestine_Terminal_Ileum 187\n40                                 Ovary 180\n41  Brain_Anterior_cingulate_cortex_BA24 176\n42     Cells_EBV-transformed_lymphocytes 174\n43                  Minor_Salivary_Gland 162\n44        Brain_Spinal_cord_cervical_c-1 159\n45                                Vagina 156\n46                        Brain_Amygdala 152\n47                                Uterus 142\n48                Brain_Substantia_nigra 139\n49                         Kidney_Cortex  85\n50                               Bladder  21\n51                     Cervix_Endocervix  10\n52                     Cervix_Ectocervix   9\n53                        Fallopian_Tube   9\n54                        Kidney_Medulla   4\n```\n\n\n:::\n:::\n\n\nPut *liver* first in this list, because after filtering, I will use it to set the order of the factors.\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_keep <- c(\"Liver\", \"Heart_Left_Ventricle\", \"Heart_Atrial_Appendage\", \"Kidney_Cortex\",\n                 \"Kidney_Medulla\", \"Lung\", \"Muscle_Skeletal\", \"Pancreas\", \"Spleen\", \"Stomach\",\n                 \"Pituitary\", \"Thyroid\")\n```\n:::\n\n\nDouble-check I got all the names right\n\n::: {.cell}\n\n```{.r .cell-code}\nall(tissue_keep %in% gtex_samples[['tissue_id']])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n\nGot 'em!\n\n## Filter sample table to our scoped tissue types\n\n::: {.cell}\n\n```{.r .cell-code}\ngtex_samples_filtered <- gtex_samples %>%\n  dplyr::filter(tissue_id %in% tissue_keep) %>%\n  # on the next line, set order of factors with liver first\n  mutate(\"tissue_id\" = fct_relevel(as_factor(tissue_id), tissue_keep) )\ndplyr::count(gtex_samples_filtered)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     n\n1 4421\n```\n\n\n:::\n:::\n\n\n4421 / 17382 = .254 . We are keeping ~ 25% of samples that were in GTEx v8.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngtex_samples_filtered %>%\n  dplyr::count(tissue_id) %>%\n  mutate(\"percent\" = signif(n / sum(n) * 100, digits = 2)) %>%\n  arrange(desc(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                tissue_id   n percent\n1         Muscle_Skeletal 803   18.00\n2                 Thyroid 653   15.00\n3                    Lung 578   13.00\n4    Heart_Left_Ventricle 432    9.80\n5  Heart_Atrial_Appendage 429    9.70\n6                 Stomach 359    8.10\n7                Pancreas 328    7.40\n8               Pituitary 283    6.40\n9                  Spleen 241    5.50\n10                  Liver 226    5.10\n11          Kidney_Cortex  85    1.90\n12         Kidney_Medulla   4    0.09\n```\n\n\n:::\n:::\n\n\n## Import the related bulk RNAseq counts\nBulk RNAseq gct files came from: https://www.gtexportal.org/home/downloads/adult-gtex\n\nI'll use read counts because that's what DEseq2's statistical modeling requires. Unzip it first:\n\n::: {.cell}\n\n```{.bash .cell-code}\ncd ..\ngunzip *.gz\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrna_counts <- read.delim(\"../../GTEX-liver-parent-dir/bulk-gex_v8_rna-seq_GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_reads.gct\",\n                         sep = \"\\t\", skip = 2) %>%\n  tibble::column_to_rownames(var = \"Name\")\n```\n:::\n\n\n### Troubleshoot filtering samples/matrix columns\n\n::: {.cell}\n\n```{.r .cell-code}\nrna_counts_cols <- colnames(rna_counts)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlength(gtex_samples_filtered[['sample_id']] %in% rna_counts_cols)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4421\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nanti_join(gtex_samples_filtered, as_tibble(rna_counts_cols),\n          by = c(\"sample_id\" = \"value\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] sample_id    donor_id     has_genotype tissue_id   \n<0 rows> (or 0-length row.names)\n```\n\n\n:::\n:::\n\n\n0 is the desired outcome of an anti-join.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrna_counts_filtered <- rna_counts %>%\n  dplyr::select(gtex_samples_filtered[['sample_id']]) %>%\n  as.matrix()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(rna_counts_filtered)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 56200  4421\n```\n\n\n:::\n:::\n\n\nGreat: filtering went correctly. The dashes-to-periods issue was irksome. We have y = 4421 samples, and 56200 features.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall(gtex_samples_filtered[['sample_id']] %in% colnames(rna_counts_filtered))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nall(gtex_samples_filtered[['sample_id']] == colnames(rna_counts_filtered))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n\nGreat, we are good to continue to DEseq2 DESeqDataSet\n\n## Filter features to protein-coding genes\nplease restrict your analyses to protein-coding genes and the following tissues: \n\n::: {.cell}\n\n```{.r .cell-code}\nkeytypes(org.Hs.eg.db)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"ACCNUM\"       \"ALIAS\"        \"ENSEMBL\"      \"ENSEMBLPROT\"  \"ENSEMBLTRANS\"\n [6] \"ENTREZID\"     \"ENZYME\"       \"EVIDENCE\"     \"EVIDENCEALL\"  \"GENENAME\"    \n[11] \"GENETYPE\"     \"GO\"           \"GOALL\"        \"IPI\"          \"MAP\"         \n[16] \"OMIM\"         \"ONTOLOGY\"     \"ONTOLOGYALL\"  \"PATH\"         \"PFAM\"        \n[21] \"PMID\"         \"PROSITE\"      \"REFSEQ\"       \"SYMBOL\"       \"UCSCKG\"      \n[26] \"UNIPROT\"     \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nensgs_to_filter <- tibble(\"ENSG\" = dimnames(rna_counts_filtered)[[1]])\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nensgs_filtered_protein <- ensgs_to_filter %>%\n  mutate(\"short_ensg\" = str_remove(ENSG, \"(?<=ENSG\\\\d{1,14})\\\\.{0,1}\\\\d{0,3}$\"),\n         \"genetype\" = mapIds(org.Hs.eg.db,\n                           keys = short_ensg,\n                           column = \"GENETYPE\",\n                           keytype = \"ENSEMBL\",\n                           multiVals = \"first\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n'select()' returned 1:many mapping between keys and columns\n```\n\n\n:::\n\n```{.r .cell-code}\ndplyr::count(ensgs_filtered_protein, genetype) %>% arrange(desc(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 10 × 2\n   genetype           n\n   <chr>          <int>\n 1 <NA>           21144\n 2 protein-coding 19198\n 3 pseudo          8918\n 4 ncRNA           5820\n 5 snoRNA           654\n 6 other            368\n 7 snRNA             75\n 8 rRNA              20\n 9 scRNA              2\n10 unknown            1\n```\n\n\n:::\n\n```{.r .cell-code}\nensgs_filtered_protein <- dplyr::filter(ensgs_filtered_protein, genetype == \"protein-coding\")\n```\n:::\n\n\nActually apply the filter below\n\n::: {.cell}\n\n```{.r .cell-code}\nrna_counts_filtered <- rna_counts_filtered[ensgs_filtered_protein[[1]], ]\ndim(rna_counts_filtered)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 19198  4421\n```\n\n\n:::\n:::\n\n\n### Number of features\n\n::: {.cell}\n\n```{.r .cell-code}\ndplyr::count(ensgs_to_filter)[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 56200\n```\n\n\n:::\n:::\n\n\n19184/56200 = 34%, so we are keeping 34% of features in the counts matrix, because ENSEMBL annotates them as protein-coding. Thus we are jettisoning 66% of features as being non-protein coding. What the ENCODE db indicates is that annotated ENCODE entries are the most common, followed by pseudo, ncRNA, snoRNA, \"other,\" snRNA, rRNA, scRNA, and \"unknown.\"\n\n# Run DEseq2 analysis\n## Prepare data object for DEseq2\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_DE <- DESeqDataSetFromMatrix(countData = rna_counts_filtered,\n                              colData = gtex_samples_filtered,\n                              design = ~ tissue_id)\ntissue_DE\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass: DESeqDataSet \ndim: 19198 4421 \nmetadata(1): version\nassays(1): counts\nrownames(19198): ENSG00000186092.4 ENSG00000187634.11 ...\n  ENSG00000198695.2 ENSG00000198727.2\nrowData names(0):\ncolnames(4421): GTEX.1117F.0426.SM.5EGHI GTEX.1117F.0726.SM.5GIEN ...\n  GTEX.ZZPU.1426.SM.5GZZ6 GTEX.ZZPU.2626.SM.5E45Y\ncolData names(4): sample_id donor_id has_genotype tissue_id\n```\n\n\n:::\n:::\n\n\n### Filter for minimum counts\nFilter for features (genes) where there are less than 113 or more samples with normalized counts greater than or equal to 5. (113 is half the number of liver samples in the data, allowing for at least some dispersion in at least among the samples of the tissue type we want to understand.)\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_DE <- estimateSizeFactors(tissue_DE)\nidx <- rowSums( counts(tissue_DE, normalized = TRUE) >= 5 ) >= 113\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_DE <- tissue_DE[idx,]\ndim(tissue_DE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 18023  4421\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n(56200-33387);\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 22813\n```\n\n\n:::\n\n```{.r .cell-code}\n(56200-33387)/56200\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.4059253\n```\n\n\n:::\n\n```{.r .cell-code}\n(19184-18013)/19184\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.06104045\n```\n\n\n:::\n:::\n\n\nOriginally, when filtering for features with a minimum number of counts over the minimum number of genes, I filtered out 22,813 (40.6%) based on low counts / coverage. *However, now the I'm filtering genes for counts _after_ filtering for protein coding genes*, only 6.1% of features are dropped. This difference in proportionality indicates that low count features and protein coding genes are not necessarily independent. In fact, the non-protein-coding features were enriched for low expression levels across many of the samples.\n\n## Run DEseq2 analysis\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(gtex_samples, gtex_samples_filtered, rna_counts_filtered, rna_counts)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_DE <- DESeq(tissue_DE)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nusing pre-existing size factors\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nestimating dispersions\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\ngene-wise dispersion estimates\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nmean-dispersion relationship\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfinal dispersion estimates\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfitting model and testing\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n-- replacing outliers and refitting for 237 genes\n-- DESeq argument 'minReplicatesForReplace' = 7 \n-- original counts are preserved in counts(dds)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nestimating dispersions\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfitting model and testing\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncontrasts_no_intercept <- resultsNames(tissue_DE)[2:length(resultsNames(tissue_DE))]\ncontrasts_no_intercept\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"tissue_id_Heart_Left_Ventricle_vs_Liver\"  \n [2] \"tissue_id_Heart_Atrial_Appendage_vs_Liver\"\n [3] \"tissue_id_Kidney_Cortex_vs_Liver\"         \n [4] \"tissue_id_Kidney_Medulla_vs_Liver\"        \n [5] \"tissue_id_Lung_vs_Liver\"                  \n [6] \"tissue_id_Muscle_Skeletal_vs_Liver\"       \n [7] \"tissue_id_Pancreas_vs_Liver\"              \n [8] \"tissue_id_Spleen_vs_Liver\"                \n [9] \"tissue_id_Stomach_vs_Liver\"               \n[10] \"tissue_id_Pituitary_vs_Liver\"             \n[11] \"tissue_id_Thyroid_vs_Liver\"               \n```\n\n\n:::\n:::\n\n\n### Extract all contrast data from DEseq\n\n::: {.cell}\n\n```{.r .cell-code}\ncombine_contrast_results <- function(deseq_obj){\n  \n  contrasts_no_intercept <- resultsNames(deseq_obj)[2:length(resultsNames(deseq_obj))]\n  \n  bind_rows(purrr::map(contrasts_no_intercept, ~ mutate(\n    tibble::rownames_to_column(as.data.frame(results(deseq_obj, name = .x)),\n                               \"ENSG\"),\n    \"contrast\" = .x)\n    )\n  )\n}\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_DE_results_long <- combine_contrast_results(tissue_DE) %>%\n  mutate(\"contrast\" = str_remove(contrast, \"^tissue_id_\"))\n\ndplyr::count(tissue_DE_results_long, contrast)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                          contrast     n\n1  Heart_Atrial_Appendage_vs_Liver 18023\n2    Heart_Left_Ventricle_vs_Liver 18023\n3           Kidney_Cortex_vs_Liver 18023\n4          Kidney_Medulla_vs_Liver 18023\n5                    Lung_vs_Liver 18023\n6         Muscle_Skeletal_vs_Liver 18023\n7                Pancreas_vs_Liver 18023\n8               Pituitary_vs_Liver 18023\n9                  Spleen_vs_Liver 18023\n10                Stomach_vs_Liver 18023\n11                Thyroid_vs_Liver 18023\n```\n\n\n:::\n:::\n\n\n## Prepare data with additional annotations\n#### Check if ENSG string manipulation prodcuces unique values\n\n::: {.cell}\n\n```{.r .cell-code}\ndplyr::count(as_tibble(str_remove(row.names(tissue_DE_results_long),\n           \"(?<=ENSG\\\\d{1,14})\\\\.{0,1}\\\\d{0,3}$\")), value) %>%\n  dplyr::count(n);\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n      n     nn\n  <int>  <int>\n1     1 198253\n```\n\n\n:::\n\n```{.r .cell-code}\ndplyr::count(as_tibble(row.names(tissue_DE_results_long)), value) %>%\n  dplyr::count(n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n      n     nn\n  <int>  <int>\n1     1 198253\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_DE_results_long <- tissue_DE_results_long %>%\n  mutate(\"short_ensg\" = str_remove(ENSG, \"(?<=ENSG\\\\d{1,14})\\\\.{0,1}\\\\d{0,3}$\"),\n         \"symbol\" = mapIds(org.Hs.eg.db,\n                           keys = short_ensg,\n                           column = \"SYMBOL\",\n                           keytype = \"ENSEMBL\",\n                           multiVals = \"first\"),\n         \"entrez\" = mapIds(org.Hs.eg.db,\n                           keys = short_ensg,\n                           column = \"ENTREZID\",\n                           keytype = \"ENSEMBL\",\n                           multiVals = \"first\"),\n         \"name\" = mapIds(org.Hs.eg.db,\n                         keys = short_ensg,\n                         column = \"GENENAME\",\n                         keytype = \"ENSEMBL\",\n                         multiVals = \"first\")\n         )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n'select()' returned 1:many mapping between keys and columns\n'select()' returned 1:many mapping between keys and columns\n'select()' returned 1:many mapping between keys and columns\n```\n\n\n:::\n:::\n\n\n### Further explore the contrasts\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_10_hits_summary <- tissue_DE_results_long %>%\n  mutate(\"log2FoldChange\" = -1*log2FoldChange) %>%\n  group_by(contrast) %>%\n  arrange(stat, log2FoldChange) %>%\n  slice_head(n = 10) %>%\n  relocate(\"contrast\", \"short_ensg\", \"symbol\", \"entrez\", \"name\", \"log2FoldChange\")\n\ntop_10_hits_summary %>% dplyr::select(\"contrast\", \"symbol\", \"name\", \"log2FoldChange\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 110 × 4\n# Groups:   contrast [11]\n   contrast                        symbol  name                   log2FoldChange\n   <chr>                           <chr>   <chr>                           <dbl>\n 1 Heart_Atrial_Appendage_vs_Liver SLC27A5 solute carrier family…           7.77\n 2 Heart_Atrial_Appendage_vs_Liver RDH16   retinol dehydrogenase…           9.76\n 3 Heart_Atrial_Appendage_vs_Liver SLC22A1 solute carrier family…          11.8 \n 4 Heart_Atrial_Appendage_vs_Liver CYP2E1  cytochrome P450 famil…          11.5 \n 5 Heart_Atrial_Appendage_vs_Liver ASGR1   asialoglycoprotein re…          10.1 \n 6 Heart_Atrial_Appendage_vs_Liver CYP2D6  cytochrome P450 famil…           8.74\n 7 Heart_Atrial_Appendage_vs_Liver CPS1    carbamoyl-phosphate s…           8.98\n 8 Heart_Atrial_Appendage_vs_Liver APOM    apolipoprotein M                 7.20\n 9 Heart_Atrial_Appendage_vs_Liver ATF5    activating transcript…           7.22\n10 Heart_Atrial_Appendage_vs_Liver MST1    macrophage stimulatin…           7.25\n# ℹ 100 more rows\n```\n\n\n:::\n:::\n\n\nThis is looking promising. When sorted by statistic and the top ten genes are displayed from each tissue, there are many common genes that are relatively up-regulated (in mRNA expression) in liver compared to each of the other tissues. SLC27A5 is very commonly (and very strongly) up-regulated in liver; RDH16 and CPS1 are as well.\n\n\n\n\n\n### MA Plot (analysis QC)\n\n::: {.cell}\n\n```{.r .cell-code}\nma_plot <- tissue_DE_results_long %>%\n  ggplot(aes(y = log2FoldChange, x = baseMean)) +\n  geom_point(alpha = 0.1, size = .1) +\n  geom_density_2d() +\n  stat_smooth(formula = y ~ x, method = lm, color = \"yellow\", linewidth = 0.3) +\n  scale_x_log10() +\n  labs(title = \"MA-plot: a scatter plot of log2 fold changes\",\n       x = \"mean of normalized counts\",\n       y = \"log2 fold change\") +\n  facet_wrap(~ contrast)\nma_plot\n```\n\n::: {.cell-output-display}\n![](2024_01_03-GTEX_RNA_seq_liver_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\nFor all contrasts, the data points (gene IDs) are roughly symmetric around the x-axis (indicating no systematic bias), and the majority are close to the x-axis, indicating many genes are not differentially expressed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nma_hist <- tissue_DE_results_long %>%\n  ggplot(aes(log2FoldChange)) +\n  geom_histogram(binwidth = 1) +\n  labs(title = \"MA-plot: histogram of log2 fold changes\",\n       y = \"number of genes\",\n       x = \"log2 fold change\") +\n  facet_wrap(~ contrast)\nma_hist\n```\n\n::: {.cell-output-display}\n![](2024_01_03-GTEX_RNA_seq_liver_files/figure-html/unnamed-chunk-35-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nma_hist_stats <- tissue_DE_results_long %>%\n  group_by(contrast) %>%\n  dplyr::summarize(\"mean log2FoldChange\" = mean(log2FoldChange),\n                   \"S.D. log2FoldChange\" = sd(log2FoldChange),\n                   \"n features\" = n())\nma_hist_stats\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 11 × 4\n   contrast             `mean log2FoldChange` `S.D. log2FoldChange` `n features`\n   <chr>                                <dbl>                 <dbl>        <int>\n 1 Heart_Atrial_Append…               -0.0807                  2.49        18023\n 2 Heart_Left_Ventricl…               -0.160                   2.53        18023\n 3 Kidney_Cortex_vs_Li…                0.120                   2.10        18023\n 4 Kidney_Medulla_vs_L…               -0.0501                  2.29        18023\n 5 Lung_vs_Liver                       0.134                   2.37        18023\n 6 Muscle_Skeletal_vs_…               -0.342                   2.77        18023\n 7 Pancreas_vs_Liver                  -0.0455                  2.21        18023\n 8 Pituitary_vs_Liver                  0.229                   2.69        18023\n 9 Spleen_vs_Liver                    -0.156                   2.36        18023\n10 Stomach_vs_Liver                    0.112                   2.27        18023\n11 Thyroid_vs_Liver                   -0.0922                  2.37        18023\n```\n\n\n:::\n:::\n\n\nAs a clearer summary plot, the histograms for each contrast a preponderance of genes are close to the 0 on the x-axis, indicating many features have limited fold change between samples.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstat_hist <- tissue_DE_results_long %>%\n  ggplot(aes(stat)) +\n  geom_histogram(bins = 40) +\n  labs(title = \"Stat (statistic)\",\n       y = \"number of genes\",\n       x = \"Statistic\") +\n  facet_wrap(~ contrast)\nstat_hist\n```\n\n::: {.cell-output-display}\n![](2024_01_03-GTEX_RNA_seq_liver_files/figure-html/unnamed-chunk-37-1.png){width=672}\n:::\n:::\n\n\nWhile the test statistic outputted by DEseq2 is less \"clipped\" to zero than the p-values (many of which exhaust the range and get reported as 0.000000e+00), the statistic range/distribution is not the same for all contrasts, notably for the Kidney Medulla vs Liver comparison. This can be explained from the [Filter sample table to our scoped tissue types](#Filter-sample-table-to-our-scoped-tissue-types) section of this document, which shows the Kidney Medulla GTEx tissue set as having far fewer samples (n = 4) than the other tissue types (mean = 368, sd = 230).\n\nAs long as we `group_by()` when ranking, sorting, and otherwise comparing (in long format), this should be okay. Once pivoted into wide format, this can present a problem because not every column of values will be able to react similarly to the same ranking, sorting, or cut-offs.\n\n\n\n\n\n# Cross-contrast analysis\n## Summarize by feature\nWhich is effectively a wide format, appropriate for joining.\n(Grouped-by calculations in the same column run more efficiently and are easier to program than row-wise multi-column calculations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_DE_results_feature_summary <- tissue_DE_results_long %>%\n  summarize(across(.cols = c(\"log2FoldChange\", \"stat\"),\n                   .fns = c(\"mean\" = mean, \"sd\" = sd,\n                            \"below_zero_min\" = ~ min( (.x[.x <0]) ) ),\n                   .names = \"{.fn}_{.col}\"),\n            across(.cols = c(\"lfcSE\", \"pvalue\", \"padj\"),\n                   .fns = c(\"mean\" = mean, \"sd\" = sd,\n                            \"min\" = min),\n                   .names = \"{.fn}_{.col}\"),\n            .by = c(\"ENSG\", \"short_ensg\", \"symbol\", \"entrez\", \"name\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: There were 4798 warnings in `summarize()`.\nThe first warning was:\nℹ In argument: `across(...)`.\nℹ In group 7: `ENSG = \"ENSG00000188290.10\"`, `short_ensg = \"ENSG00000188290\"`,\n  `symbol = \"HES4\"`, `entrez = \"57801\"`, `name = \"hes family bHLH transcription\n  factor 4\"`.\nCaused by warning in `min()`:\n! no non-missing arguments to min; returning Inf\nℹ Run `dplyr::last_dplyr_warnings()` to see the 4797 remaining warnings.\n```\n\n\n:::\n:::\n\n\nTo explain why I'm contriving these summary statistics, I have to first acknowledge that downstream processing (GO analysis, TF.ChIP) expects continuous data ( _e.g._  `log2FoldChange`, `adj.p.val`) for *both* the up-regulated and down-regulated features. Thus, in drawing conclusions from the comparisons, I am balancing maintaining continuous variables that can be used later with summary statistics that _suggest_ consistency across all the tissue type comparisons made (and in the case of the highly confident features/genes, these suggestive consistency metrics indicate high levels of agreement).\n\nThese metrics are the `mean_log2FoldChange`, `sd_log2FoldChange`, and the `below_zero_min_log2FoldChange`, (as well as these versions on `stat` and `padj`). Together, these continuous feature summary metrics describe how consistently the metrics are across comparisons (e.g. liver to thyroid, liver to lung, etc.). When a feature is specific to the liver, the mean will be negative and large, the sd will be smaller than the mean, and the min_below_zero will not be far away from the mean. Such an outcome indicates that all the comparisons agree that a gene is specifically up-regulated in the liver compared to all other tissues considered here.\n\nApplying these summary transformations to the `log2FoldChange`, `pvalue`, and `padj` are reasonable because these metrics either do not depend on the number of samples (`log2FoldChange`), or account for the number of samples in the condition (`pvalue`, and `padj`), explicitly allowing for comparisons between conditions.\n\n## Pivot to wide\n\n::: {.cell}\n\n```{.r .cell-code}\ntissue_DE_results_wide <- tissue_DE_results_long %>%\n  pivot_wider(id_cols = c(\"ENSG\", \"short_ensg\", \"symbol\", \"entrez\", \"name\"),\n              names_from = \"contrast\",\n              values_from = c(\"baseMean\", \"log2FoldChange\", \"lfcSE\", \"stat\", \"pvalue\", \"padj\")) %>%\n  left_join(tissue_DE_results_feature_summary,\n            by = c(\"ENSG\", \"short_ensg\", \"symbol\", \"entrez\", \"name\")) %>%\n  relocate(short_ensg, mean_log2FoldChange, mean_stat, symbol, name,\n           sd_log2FoldChange, below_zero_min_log2FoldChange, sd_stat, below_zero_min_stat, mean_lfcSE,\n           sd_lfcSE, min_lfcSE, mean_pvalue, sd_pvalue, min_pvalue, mean_padj, sd_padj, min_padj) %>%\n  arrange(mean_padj, mean_log2FoldChange)\n```\n:::\n\n\n\n\n# Pathway / Gene Ontology (GO) Enrichment Analysis\n\n::: {.cell}\n\n```{.r .cell-code}\nslice_head(dplyr::select(tissue_DE_results_wide,\n                         mean_log2FoldChange, sd_log2FoldChange, mean_pvalue, symbol, name),\n           n = 20)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 20 × 5\n   mean_log2FoldChange sd_log2FoldChange mean_pvalue symbol  name               \n                 <dbl>             <dbl>       <dbl> <chr>   <chr>              \n 1               -7.60             0.560   1.66e-214 SLC27A5 solute carrier fam…\n 2               -9.37             0.785   5.51e-156 RDH16   retinol dehydrogen…\n 3               -9.48             0.401   5.40e-152 CPS1    carbamoyl-phosphat…\n 4               -8.15             1.04    1.47e-147 A1BG    alpha-1-B glycopro…\n 5               -9.56             1.28    1.90e-135 ASGR1   asialoglycoprotein…\n 6              -10.5              0.842   1.91e-124 CYP2E1  cytochrome P450 fa…\n 7              -10.5              1.93    7.35e-119 VTN     vitronectin        \n 8              -10.3              0.948   7.10e-118 SLC22A1 solute carrier fam…\n 9               -6.96             0.329   1.60e-116 ATF5    activating transcr…\n10               -6.88             1.01    2.56e-106 ANG     angiogenin         \n11              -11.3              2.46    7.90e-100 APOB    apolipoprotein B   \n12              -11.5              1.01    5.25e- 98 HPX     hemopexin          \n13               -7.68             1.31    2.42e- 97 ITIH4   inter-alpha-trypsi…\n14              -12.0              1.89    2.99e- 92 APOA1   apolipoprotein A1  \n15              -10.3              1.84    1.37e- 90 TFR2    transferrin recept…\n16               -4.45             0.542   1.93e- 88 DHODH   dihydroorotate deh…\n17               -9.34             1.81    6.04e- 88 APOC1   apolipoprotein C1  \n18              -10.7              1.03    3.93e- 86 TF      transferrin        \n19               -7.63             1.10    5.78e- 85 CYP2D6  cytochrome P450 fa…\n20                4.33             2.05    6.71e- 84 AIF1L   allograft inflamma…\n```\n\n\n:::\n:::\n\n\nChecking in on genes and hypotheses:\n\n 1. conditioning the blood by secreting important proteins into it, like serum albumin, immune complement proteins, C-reactive protein, clotting factors (pre-pro-thrombin, fibrinogen, plasminogen), etc.\n    * fibrinogen alpha chain\n    * amyloid P component, serum\n    * coagulation factor IX\n    * fibrinogen beta chain\n    * complement C8 beta chain\n    * plasminogen\n    * fibrinogen gamma chain\n    * C-reactive protein\n    * complement factor H related 2\n    * complement factor H related 5\n    * complement C8 alpha chain\n    * coagulation factor II, thrombin\n    * albumin\n    * complement C9\n    * coagulation factor XIII B chain\n 1. cytochrome P450 proteins (CYPxxx), by which the liver catabolizes xenobiotics\n    * cytochrome P450 family 2 subfamily B member 6\n    * cytochrome P450 family 2 subfamily C member 9\n    * cytochrome P450 family 4 subfamily F member 2\n 1. glycolysis, gluconeogenesis, and fatty acid catabolism\n    * apolipoprotein C3\n    * apolipoprotein H\n    * apolipoprotein A2\n    * glucose-6-phosphatase catalytic subunit 1\n    * aldolase, fructose-bisphosphate B\n 1. bile salts catabolism and anabolism (cholesterols, hemoglobin/porphyrin)\n    * ??? (we'll see later in the pathways analysis)\n 1. amino acid conversion and catabolism\n    * alanine--glyoxylate aminotransferase\n    * tyrosine aminotransferase\n    * alanine--glyoxylate aminotransferase 2\n\nI didn't find many bile salts and cholesterol metabolism genes. Curious. Maybe this is a lesser function of the liver than I imagined, or maybe tissue sampling area makes a difference.\n\nI also recovered some interesting \"other\" proteins:\n\n * GC vitamin D binding protein\n * serpin family A member 7\n * hydroxyacid oxidase 1\n * UDP glucuronosyltransferase family 2 member B10\n * kininogen 1\n * mannose binding lectin 2\n * UDP glucuronosyltransferase family 2 member B4\n * serpin family A member 11\n * secreted phosphoprotein 2\n * solute carrier family 2 member 2\n * carboxypeptidase N subunit 1\n * cAMP responsive element binding protein 3 like 3\n * insulin like growth factor binding protein 1\n\nThemes on vitamin D, UDP-yl-ation (a means of preparing xenobiotics for excretion), and regulatory / signaling proteins.\n\n## Pathway analysis\nwith GAGE\n\n### Prepare GAGE's needed data\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(kegg.sets.hs)\ndata(sigmet.idx.hs)\nkegg.sets.hs = kegg.sets.hs[sigmet.idx.hs]\n```\n:::\n\n\n### Perpare DEseq2 result for GAGE\n\n::: {.cell}\n\n```{.r .cell-code}\nfoldchanges = tissue_DE_results_wide$mean_log2FoldChange\nnames(foldchanges) = tissue_DE_results_wide$entrez\nhead(foldchanges)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     10998       8608       1373          1        432       1571 \n -7.601432  -9.367489  -9.478086  -8.152599  -9.564476 -10.454284 \n```\n\n\n:::\n:::\n\n\n## Run GAGE\n\n::: {.cell}\n\n```{.r .cell-code}\nkeggres = gage(foldchanges, gsets = kegg.sets.hs, same.dir = TRUE)\n```\n:::\n\n\n### View Results\nRemember that \"down-regulated\" (i.e. the \"$less\" table) is *up-regulated* in liver, due to the DEseq contrasts.\n\n::: {.cell}\n\n```{.r .cell-code}\nas.data.frame(head(keggres$less, 20)) %>%\n  dplyr::select(\"p.geomean\", \"stat.mean\", \"p.val\", \"set.size\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                                         p.geomean stat.mean\nhsa00830 Retinol metabolism                           2.779301e-15 -9.570937\nhsa00982 Drug metabolism - cytochrome P450            1.480861e-13 -8.552114\nhsa00980 Metabolism of xenobiotics by cytochrome P450 3.742608e-12 -7.909572\nhsa00140 Steroid hormone biosynthesis                 7.829862e-12 -7.983658\nhsa00983 Drug metabolism - other enzymes              3.227821e-11 -7.785412\nhsa04610 Complement and coagulation cascades          1.590380e-10 -7.112876\nhsa00260 Glycine, serine and threonine metabolism     8.543085e-08 -6.071404\nhsa00053 Ascorbate and aldarate metabolism            3.398045e-07 -6.247135\nhsa04146 Peroxisome                                   3.456135e-07 -5.215038\nhsa00071 Fatty acid metabolism                        8.363971e-07 -5.220379\nhsa00040 Pentose and glucuronate interconversions     8.446235e-07 -5.659101\nhsa00860 Porphyrin and chlorophyll metabolism         3.474540e-06 -4.994513\nhsa00500 Starch and sucrose metabolism                5.047958e-06 -4.774060\nhsa00380 Tryptophan metabolism                        1.180799e-05 -4.535570\nhsa00280 Valine, leucine and isoleucine degradation   2.437706e-05 -4.277734\nhsa03320 PPAR signaling pathway                       4.831137e-05 -4.070571\nhsa04976 Bile secretion                               5.608400e-05 -4.037952\nhsa04975 Fat digestion and absorption                 8.538312e-05 -4.013194\nhsa00120 Primary bile acid biosynthesis               1.087369e-04 -4.465205\nhsa00591 Linoleic acid metabolism                     1.465698e-04 -4.016737\n                                                             p.val set.size\nhsa00830 Retinol metabolism                           2.779301e-15       60\nhsa00982 Drug metabolism - cytochrome P450            1.480861e-13       68\nhsa00980 Metabolism of xenobiotics by cytochrome P450 3.742608e-12       66\nhsa00140 Steroid hormone biosynthesis                 7.829862e-12       52\nhsa00983 Drug metabolism - other enzymes              3.227821e-11       48\nhsa04610 Complement and coagulation cascades          1.590380e-10       69\nhsa00260 Glycine, serine and threonine metabolism     8.543085e-08       32\nhsa00053 Ascorbate and aldarate metabolism            3.398045e-07       22\nhsa04146 Peroxisome                                   3.456135e-07       78\nhsa00071 Fatty acid metabolism                        8.363971e-07       43\nhsa00040 Pentose and glucuronate interconversions     8.446235e-07       28\nhsa00860 Porphyrin and chlorophyll metabolism         3.474540e-06       38\nhsa00500 Starch and sucrose metabolism                5.047958e-06       50\nhsa00380 Tryptophan metabolism                        1.180799e-05       42\nhsa00280 Valine, leucine and isoleucine degradation   2.437706e-05       44\nhsa03320 PPAR signaling pathway                       4.831137e-05       70\nhsa04976 Bile secretion                               5.608400e-05       70\nhsa04975 Fat digestion and absorption                 8.538312e-05       44\nhsa00120 Primary bile acid biosynthesis               1.087369e-04       16\nhsa00591 Linoleic acid metabolism                     1.465698e-04       28\n```\n\n\n:::\n:::\n\n\nWhat's *down-regulated in liver* _compared to other tissues in the scope of our analysis_?\n\n::: {.cell}\n\n```{.r .cell-code}\nas.data.frame(head(keggres$greater, 30)) %>%\n  dplyr::select(\"p.geomean\", \"stat.mean\", \"p.val\", \"set.size\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                                            p.geomean stat.mean\nhsa04260 Cardiac muscle contraction                      4.226930e-05 4.0485431\nhsa04510 Focal adhesion                                  8.259308e-05 3.8042683\nhsa04020 Calcium signaling pathway                       4.162910e-04 3.3711842\nhsa04971 Gastric acid secretion                          4.992409e-04 3.3629263\nhsa04540 Gap junction                                    2.260180e-03 2.8795187\nhsa04512 ECM-receptor interaction                        1.063049e-02 2.3255219\nhsa00512 Mucin type O-Glycan biosynthesis                1.216787e-02 2.3178454\nhsa04310 Wnt signaling pathway                           1.365919e-02 2.2195964\nhsa04010 MAPK signaling pathway                          1.744613e-02 2.1151951\nhsa04740 Olfactory transduction                          1.772475e-02 2.1215165\nhsa04144 Endocytosis                                     1.777225e-02 2.1102659\nhsa04360 Axon guidance                                   2.267219e-02 2.0114313\nhsa04810 Regulation of actin cytoskeleton                2.364354e-02 1.9896256\nhsa04070 Phosphatidylinositol signaling system           4.524494e-02 1.7041610\nhsa04742 Taste transduction                              4.633914e-02 1.7021994\nhsa04666 Fc gamma R-mediated phagocytosis                5.200090e-02 1.6354378\nhsa00603 Glycosphingolipid biosynthesis - globo series   5.488971e-02 1.6593012\nhsa04916 Melanogenesis                                   6.589818e-02 1.5133800\nhsa04960 Aldosterone-regulated sodium reabsorption       7.526571e-02 1.4512414\nhsa04970 Salivary secretion                              7.787447e-02 1.4259647\nhsa04966 Collecting duct acid secretion                  9.503672e-02 1.3287753\nhsa04720 Long-term potentiation                          1.029613e-01 1.2717033\nhsa04722 Neurotrophin signaling pathway                  1.100258e-01 1.2305040\nhsa04012 ErbB signaling pathway                          1.306016e-01 1.1275052\nhsa00604 Glycosphingolipid biosynthesis - ganglio series 1.335755e-01 1.1341216\nhsa04730 Long-term depression                            1.385772e-01 1.0911741\nhsa04330 Notch signaling pathway                         1.424132e-01 1.0774610\nhsa04962 Vasopressin-regulated water reabsorption        1.465997e-01 1.0579483\nhsa03010 Ribosome                                        1.579660e-01 1.0084068\nhsa00562 Inositol phosphate metabolism                   1.619385e-01 0.9910216\n                                                                p.val set.size\nhsa04260 Cardiac muscle contraction                      4.226930e-05       76\nhsa04510 Focal adhesion                                  8.259308e-05      200\nhsa04020 Calcium signaling pathway                       4.162910e-04      176\nhsa04971 Gastric acid secretion                          4.992409e-04       73\nhsa04540 Gap junction                                    2.260180e-03       88\nhsa04512 ECM-receptor interaction                        1.063049e-02       84\nhsa00512 Mucin type O-Glycan biosynthesis                1.216787e-02       30\nhsa04310 Wnt signaling pathway                           1.365919e-02      148\nhsa04010 MAPK signaling pathway                          1.744613e-02      262\nhsa04740 Olfactory transduction                          1.772475e-02       97\nhsa04144 Endocytosis                                     1.777225e-02      201\nhsa04360 Axon guidance                                   2.267219e-02      129\nhsa04810 Regulation of actin cytoskeleton                2.364354e-02      209\nhsa04070 Phosphatidylinositol signaling system           4.524494e-02       78\nhsa04742 Taste transduction                              4.633914e-02       43\nhsa04666 Fc gamma R-mediated phagocytosis                5.200090e-02       93\nhsa00603 Glycosphingolipid biosynthesis - globo series   5.488971e-02       14\nhsa04916 Melanogenesis                                   6.589818e-02       99\nhsa04960 Aldosterone-regulated sodium reabsorption       7.526571e-02       42\nhsa04970 Salivary secretion                              7.787447e-02       85\nhsa04966 Collecting duct acid secretion                  9.503672e-02       27\nhsa04720 Long-term potentiation                          1.029613e-01       69\nhsa04722 Neurotrophin signaling pathway                  1.100258e-01      127\nhsa04012 ErbB signaling pathway                          1.306016e-01       87\nhsa00604 Glycosphingolipid biosynthesis - ganglio series 1.335755e-01       15\nhsa04730 Long-term depression                            1.385772e-01       68\nhsa04330 Notch signaling pathway                         1.424132e-01       47\nhsa04962 Vasopressin-regulated water reabsorption        1.465997e-01       43\nhsa03010 Ribosome                                        1.579660e-01       87\nhsa00562 Inositol phosphate metabolism                   1.619385e-01       57\n```\n\n\n:::\n:::\n\n\nNote that the p-values for pathways down-regulated in the liver are less significant than those of pathways up-regulated, likely due to by high dispersion among the comparison tissues.\n\n### Pathway plots\n\n::: {.cell}\n\n```{.r .cell-code}\nkeggrespathways <- data.frame(id = rownames(keggres$less), keggres$less) %>% \n  as_tibble() %>%\n  dplyr::slice_head(n = 5) %>% \n  .$id %>% \n  as.character() %>%\n  # top 5, plus some pet pathways part of my starting hypothesis\n  append(\"hsa04976 Bile secretion\") %>%\n  append(\"hsa00860 Porphyrin and chlorophyll metabolism\") %>%\n  append(\"hsa00280 Valine, leucine and isoleucine degradation\")\n\nkeggresids = str_sub(keggrespathways, start = 1, end = 8)\n\nkeggrespathways\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"hsa00830 Retinol metabolism\"                          \n[2] \"hsa00982 Drug metabolism - cytochrome P450\"           \n[3] \"hsa00980 Metabolism of xenobiotics by cytochrome P450\"\n[4] \"hsa00140 Steroid hormone biosynthesis\"                \n[5] \"hsa00983 Drug metabolism - other enzymes\"             \n[6] \"hsa04976 Bile secretion\"                              \n[7] \"hsa00860 Porphyrin and chlorophyll metabolism\"        \n[8] \"hsa00280 Valine, leucine and isoleucine degradation\"  \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(\"./2024_01_03-GTEX_RNA_seq_liver/\")\n# Define plotting function for applying later\nplot_pathway <- function(pid) {pathview(gene.data = foldchanges,\n                                        pathway.id = pid, species = \"hsa\", new.signature = FALSE)}\n\n# plot multiple pathways (plots saved to disk and returns a throwaway list object)\ntmp = sapply(keggresids, plot_pathway)\nsetwd(\"..\")\n```\n:::\n\n\nTypically, expression heat maps use the color-blind-unfriendly and unintuitive red for up-regulated expression, and green for decreased expression.\n\nHowever, here, because I never inverted (multiplied by -1) the log2-fold-change values, green is for increased relative expression, and red is for decreased relative expression.\n\n#### hsa00830 Retinol metabolism\n![hsa00830 Retinol metabolism](2024_01_03-GTEX_RNA_seq_liver/hsa00830.pathview.png)\n\n#### hsa00982 Drug metabolism - cytochrome P450\n![hsa00982 Drug metabolism - cytochrome P450](2024_01_03-GTEX_RNA_seq_liver/hsa00982.pathview.png)\n\n#### hsa00980 Metabolism of xenobiotics by cytochrome P450\n![hsa00980 Metabolism of xenobiotics by cytochrome P450](2024_01_03-GTEX_RNA_seq_liver/hsa00980.pathview.png)\n\n#### hsa00983 Drug metabolism - other enzymes\n![hsa00983 Drug metabolism - other enzymes](2024_01_03-GTEX_RNA_seq_liver/hsa00983.pathview.png)\n\n#### hsa00140 Steroid hormone biosynthesis\n![hsa00140 Steroid hormone biosynthesis](2024_01_03-GTEX_RNA_seq_liver/hsa00140.pathview.png)\n\n#### hsa00983 Drug metabolism - other enzymes\n![hsa00983 Drug metabolism - other enzymes](2024_01_03-GTEX_RNA_seq_liver/hsa00983.pathview.png)\n\n#### hsa04976 Bile secretion\n![hsa04976 Bile secretion](2024_01_03-GTEX_RNA_seq_liver/hsa04976.pathview.png)\n\nThe bile secretion graphic is particularly interesting because it depicts spatial regulation across cell types, and those expectations (hypotheses) are upheld by the bulk RNA-seq data from GTEx. Most hepatocyte genes are up-regulated, whereas most cholangiocyte (epithelial cells of the bile duct) genes are not up-regulated. \n\n#### hsa00860 Porphyrin and chlorophyll metabolism\n![hsa00860 Porphyrin and chlorophyll metabolism](2024_01_03-GTEX_RNA_seq_liver/hsa00860.pathview.png)\n\nPorphyrin metabolism is a curious case: not many of the GO term's genes are up-regulated, and even along a linear pathway, not all the genes in are up-regulated. I am especially surprised to see biliverdin to bilirubin conversion down-regulated relative to the other tissues in this set. Meanwhile, two of bilirubin's downstream steps are up-regulated.\n\n\n\n\n\n# Transcription Factor Enrichment Analysis\nWith `TFEA_ChIP`, we will leverage the contingency matrices crossing DEseq2 up v. down and previously-existing ChIP-seq (up v. down) data sets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nTFEA_DE_results_ordered <- as.data.frame(dplyr::select(tissue_DE_results_wide,\n                                                       \"Genes\" = short_ensg, #symbol,\n                                                       \"log2FoldChange\" = mean_log2FoldChange,\n                                                       \"pvalue\" = mean_pvalue,\n                                                       \"padj\" = mean_padj))\n\nTFEA_DE_results_ordered$log2FoldChange <- -1 * TFEA_DE_results_ordered$log2FoldChange\n\nrownames(TFEA_DE_results_ordered) <- TFEA_DE_results_ordered$short_ensg\n\nTFEA_table <- TFEA.ChIP::preprocessInputData(TFEA_DE_results_ordered)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Some genes returned 1:many mapping to ENTREZ ID. Genes were assigned the first ENTREZ ID match found.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#extract vector with names of up-regulated genes\ngenes_upreg <- TFEA.ChIP::Select_genes(TFEA_table, min_LFC = 4)\n\n#extract vector with names of non-responsive genes\n#genes_ctrl <- TFEA.ChIP::Select_genes(TFEA_table,\n#    min_pval = 0.05, max_pval = 1, max_LFC = -4)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDE_CM <- contingency_matrix(genes_upreg) # generates list of contingency tables, one per dataset\npval_up_genes <- getCMstats(DE_CM) # generates list of p-values and OR from association test\n```\n:::\n\n\n## ChIP Transcription Factor data\n\n::: {.cell}\n\n```{.r .cell-code}\nchip_index <- get_chip_index(encodeFilter = TRUE)\nDE_CM_chip <- contingency_matrix(genes_upreg, #genes_ctrl,\n                                 chip_index = chip_index)\nDE_CM_chip_stats <- getCMstats(DE_CM_chip, chip_index)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nTF_ranking <- rankTFs(DE_CM_chip_stats, rankMethod = \"gsea\", makePlot = FALSE)\nTF_ranking %>%\n  mutate(\"is_significant\" = if_else(pVal <= 0.05, TRUE, FALSE)) %>%\n  arrange(desc(is_significant), desc(ES), pVal) %>%\n  slice_head(n = 30)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             TF       ES arg.ES pVal numberOfChIPs is_significant\nFOXA2     FOXA2  0.99125      8 0.00             2           TRUE\nHNF1A     HNF1A  0.97817     16 0.02             1           TRUE\nHNF4G     HNF4G  0.97522     19 0.02             2           TRUE\nNR2F6     NR2F6  0.97234     20 0.03             1           TRUE\nHNF4A     HNF4A  0.96642     26 0.00             3           TRUE\nFOXA1     FOXA1  0.94599     40 0.01             3           TRUE\nNR2F2     NR2F2  0.94015     44 0.01             3           TRUE\nATF3       ATF3  0.76196     11 0.04             6           TRUE\nMXI1       MXI1 -0.78348    564 0.05             5           TRUE\nSIN3A     SIN3A -0.81379    654 0.04             5           TRUE\nCHD2       CHD2 -0.86508    618 0.01             5           TRUE\nMAZ         MAZ -0.88623    639 0.04             3           TRUE\nCREM       CREM -0.89989    672 0.05             2           TRUE\nELF1       ELF1 -0.90544    627 0.00             5           TRUE\nCBFB       CBFB -0.95049    660 0.04             2           TRUE\nPML         PML -0.96507    663 0.04             1           TRUE\nPBX3       PBX3 -0.97234    668 0.03             1           TRUE\nSMAD5     SMAD5 -0.99854    686 0.00             1           TRUE\nNR5A1     NR5A1  0.95779     30 0.08             1          FALSE\nHHEX       HHEX  0.95488     32 0.06             1          FALSE\nGFI1       GFI1  0.95342     33 0.12             1          FALSE\nONECUT1 ONECUT1  0.94905     36 0.11             1          FALSE\nMBD4       MBD4  0.94614     38 0.10             1          FALSE\nSOX13     SOX13  0.94469     39 0.14             1          FALSE\nPAXIP1   PAXIP1  0.93886     43 0.13             1          FALSE\nFOXJ3     FOXJ3  0.93450     46 0.19             1          FALSE\nFOXP1     FOXP1  0.93294     48 0.06             2          FALSE\nATF4       ATF4  0.92868     50 0.17             1          FALSE\nZNF609   ZNF609  0.92576     52 0.23             1          FALSE\nTHRB       THRB  0.92431     53 0.13             1          FALSE\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nTFrank_ES_p_plot <- TF_ranking %>% arrange(desc(ES)) %>%\n  mutate(\"rank\" = row_number()) %>%\n  ggplot(aes(y = ES, x = rank, color = pVal)) +\n  geom_point() +\n  scale_color_viridis_c(option = \"D\") +\n  gghighlight::gghighlight(pVal <= .05, #keep_scales = TRUE,\n                           label_key = TF,\n                           unhighlighted_params = list(color = NULL, fill = NULL,\n                                                       size = 0.3, alpha = .5)) +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  coord_cartesian(ylim = c(-1.25, 1.25)) +\n  #scale_x_continuous(trans = \"log1p\") +\n  labs(title = \"Enrichment score by rank, pVal highlighted\",\n       y = \"Enrighment score\",\n       x = \"Rank\",\n       caption = \"Enrichment score of transcription factors by rank. p-values < .05 are highlighted, other TFs are grey.\")\nTFrank_ES_p_plot\n```\n\n::: {.cell-output-display}\n![](2024_01_03-GTEX_RNA_seq_liver_files/figure-html/unnamed-chunk-55-1.png){width=672}\n:::\n:::\n\n\nNotes on TF_ranking results:\n\n - HNF4 (Hepatocyte Nuclear Factor 4) is a nuclear receptor protein mostly expressed in the liver, gut, kidney, and pancreatic beta cells that is critical for liver development.\n - Forkhead box protein A2 (FOXA2), also known as hepatocyte nuclear factor 3-beta (HNF-3B), is a transcription factor that plays an important role during development\n - ATF-3 (Cyclic AMP-dependent transcription factor) is an activating member of the mammalian activation transcription factor/cAMP responsive element-binding (CREB) protein family. *ATF-3 is induced upon physiological stress in various tissues.*\n - Forkhead box protein A1 (FOXA1), also known as hepatocyte nuclear factor 3-alpha (HNF-3A), is a transcriptional activator for liver-specific transcripts such as albumin and transthyretin, and they also interact with chromatin as a pioneer factor.\n - JUND: a functional component of the AP1 transcription factor complex. It has been proposed to protect cells from p53-dependent senescence and apoptosis.\n - TAF1 is TFIID subunit 1, a general pol II transcriptional complex component.\n  - REST: RE1-silencing transcription factor gene encodes a transcriptional repressor which represses neuronal genes in non-neuronal tissues.\n - HNF1 homeobox A (hepatocyte nuclear factor 1 homeobox A), also known as HNF1A, is ubiquitously expressed in many tissues and cell types. The protein encoded by this gene is a transcription factor that is highly expressed in the liver and is involved in the regulation of the expression of several liver-specific genes.\n\nThe GSEA option was unhelpful at sorting TFs by the level of evidence to support them (all enrichment scores were 1, and all p-values were 0). Wilcoxon doesn't make a pretty plot, but it gives us helpful sorting data.\n\nStill, I'm not impressed by these results. Even with more stringent filtering (log2-fold-change, p-value), I still can't get a list that looks specific to the liver.\n\n### Run GSEA on TFEA.ChIP\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGSEA.result[[\"Enrichment.table\"]] %>% dplyr::arrange(`pval.adj`, desc(ES)) %>% slice_head(n = 40) %>%\n  dplyr::select(!c(\"pval.adj\", \"Arg.ES\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                    Accession   Cell Treatment      TF      ES p.val\n1     ENCSR297GII.HNF4G.liver  liver             HNF4G 0.54053     0\n2      ENCSR016BMM.TAF1.liver  liver              TAF1 0.49766     0\n3     ENCSR735KEY.FOXA1.liver  liver             FOXA1 0.49263     0\n4   ENCSR000EZP.SREBF1.Hep-G2 Hep-G2            SREBF1 0.48636     0\n5     ENCSR310NYI.FOXA2.liver  liver             FOXA2 0.48343     0\n6     ENCSR324RCI.FOXA1.liver  liver             FOXA1 0.48302     0\n7     ENCSR000BQW.MBD4.Hep-G2 Hep-G2              MBD4 0.47427     0\n8      ENCSR205FOW.ATF3.liver  liver              ATF3 0.47074     0\n9      ENCSR480LIS.ATF3.liver  liver              ATF3 0.47024     0\n10  ENCSR000EVQ.TCF7L2.Hep-G2 Hep-G2            TCF7L2 0.46749     0\n11  ENCSR000EZO.SREBF2.Hep-G2 Hep-G2            SREBF2 0.45675     0\n12   ENCSR516HUP.ZBTB33.liver  liver            ZBTB33 0.45420     0\n13     ENCSR893QWP.REST.liver  liver              REST 0.45235     0\n14    ENCSR080XEY.FOXA2.liver  liver             FOXA2 0.44996     0\n15     ENCSR736BUG.EGR1.liver  liver              EGR1 0.44549     0\n16    ENCSR656JZL.HHEX.Hep-G2 Hep-G2              HHEX 0.44122     0\n17   ENCSR800QIT.HNF1A.Hep-G2 Hep-G2             HNF1A 0.43966     0\n18     ENCSR867WPH.REST.liver  liver              REST 0.43082     0\n19    ENCSR669LCD.ATF4.Hep-G2 Hep-G2              ATF4 0.42999     0\n20    ENCSR000BQX.NFIC.Hep-G2 Hep-G2              NFIC 0.42440     0\n21     ENCSR837GTK.JUND.liver  liver              JUND 0.42418     0\n22     ENCSR196HGZ.JUND.liver  liver              JUND 0.42393     0\n23      ENCSR521IID.MAX.liver  liver               MAX 0.41846     0\n24   ENCSR267DFA.FOXA1.Hep-G2 Hep-G2             FOXA1 0.41741     0\n25 ENCSR887LYD.SMARCC2.Hep-G2 Hep-G2           SMARCC2 0.41697     0\n26     ENCSR290ZOS.EGR1.liver  liver              EGR1 0.40709     0\n27   ENCSR620YNB.KAT2B.Hep-G2 Hep-G2             KAT2B 0.40506     0\n28   ENCSR000BRO.MYBL2.Hep-G2 Hep-G2             MYBL2 0.40453     0\n29   ENCSR345YWJ.ZBTB33.liver  liver            ZBTB33 0.40031     0\n30      ENCSR994YLZ.YY1.liver  liver               YY1 0.39534     0\n31   ENCSR000BVM.NR2F2.Hep-G2 Hep-G2             NR2F2 0.39042     0\n32    ENCSR444LIN.TCF7.Hep-G2 Hep-G2              TCF7 0.38687     0\n33    ENCSR849FVL.GFI1.Hep-G2 Hep-G2              GFI1 0.38592     0\n34   ENCSR029LBT.FOXP1.Hep-G2 Hep-G2             FOXP1 0.38317     0\n35   ENCSR000EEW.ESRRA.Hep-G2 Hep-G2             ESRRA 0.38049     0\n36    ENCSR000BHU.RXRA.Hep-G2 Hep-G2              RXRA 0.37795     0\n37   ENCSR000EEU.HNF4A.Hep-G2 Hep-G2             HNF4A 0.37548     0\n38   ENCSR791AGT.ZNF24.Hep-G2 Hep-G2             ZNF24 0.37417     0\n39   ENCSR413AJG.FOXJ3.Hep-G2 Hep-G2             FOXJ3 0.37378     0\n40     ENCSR000BJX.SP1.Hep-G2 Hep-G2               SP1 0.37328     0\n```\n\n\n:::\n:::\n\n\nThe above table shows that GSEA (in addition to TFEA.ChIP) also returns many liver-implicated transcriptional regulators. The above table is sorted in descending order of effect size (running enrichment score), and also displays the accession ID of the tissue sample that generated the ChIP seq data set. The TFs (transcription factors) can be in the table more than once. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nGSEA.result[[\"Enrichment.table\"]] %>% dplyr::count(TF) %>% arrange(desc(n)) %>% slice_head(n = 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       TF  n\n1    CTCF 31\n2   EP300 11\n3     MAX 11\n4    JUND 10\n5    REST 10\n6   GABPA  9\n7     MYC  7\n8    TAF1  7\n9  ZBTB33  7\n10   ATF3  6\n```\n\n\n:::\n:::\n\n\nThe above table counts the number of line items for each TF; despite CTCF (a practically ubiquitous transcriptional and chromatin regulator) being so highly represented across data sets, its running effect size was not high enough to make it show up in the top 40 (5.8%) of line items. (Same goes for EP300.)\n\nWhat this result shows is that the number of ChIP datasets under consideration in this package is not evenly distributed across all potential transcription factors, and so the number of times a transcription factor is identified as a hit is not a good measure of significance or salience.\n\n\n\n",
    "supporting": [
      "2024_01_03-GTEX_RNA_seq_liver_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}