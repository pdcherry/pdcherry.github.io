[
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "",
    "text": "I use the publicly available bulk RNA-Seq data from GTEX (v8) identify biological pathways and processes specific to the liver. I also identify putative transcriptional regulators of these pathways and processes. To ensure that the analysis fits into local memory, I restrict the features in scope to be protein-coding genes, and the tissues in scope to be the following following: heart, kidney, liver, lung, muscle, pancreas, spleen, stomach, pituitary gland, and thyroid.\n\n\nThe GTEx Consortium atlas of genetic regulatory effects across human tissues The Genotype-Tissue Expression (GTEx) project was established to characterize genetic effects on the transcriptome across human tissues and to link these regulatory mechanisms to trait and disease associations.\nI’m interpreting “specific to the liver” to mean uniquely expressed in the liver compared to each other tissue in scope. I will express this in the analysis by running instructing DEseq to run a one-to-many test by ranking liver first among the tissue factors, and then running a p-value meta-analysis on the p-value results for features (protein-coding genes) in all comparisons. (Meaning, it only takes one liver-to-tissue comparison revealing that a gene is NOT up-regulated in the liver to remove that gene from consideration.)\n\n\n\nGiven this is liver RNA-seq, I expect to see genes implicated in the liver main roles, namely:\n\nconditioning the blood by secreting important proteins into it, like serum albumin, immune complement proteins, C-reactive protein, clotting factors (pre-pro-thrombin, fibrinogen, plasminogen), etc.\ncytochrome P450 proteins (CYPxxx), by which the liver catabolizes xenobiotics\nglycolysis, gluconeogenesis, and fatty acid catabolism\nbile salts catabolism and anabolism (cholesterols, hemoglobin/porphyrin)\namino acid conversion and catabolism\n\n\nlibrary(usethis)\nlibrary(readr)                  # for reading and writing csvs\nlibrary(fs)                     # for filesystem navigation in R\nlibrary(dplyr)                  # for dataframe manipulation\nlibrary(tidyr)                  # for dataframe group nesting and manipulation\nlibrary(purrr)                  # for functional programming, including on nested dataframes\nlibrary(readxl)                 # for reading excel files\nlibrary(stringr)                # for efficient string manipulation\nlibrary(magrittr)               # for enhanced pipes\nlibrary(broom)                  # for model manipulation\nlibrary(forcats)                # for factor manipulation\nlibrary(ggplot2)                # for additional plotting features\nlibrary(ensembldb)\nlibrary(DESeq2)\nlibrary(AnnotationDbi)\nlibrary(org.Hs.eg.db)\nlibrary(gage)\nlibrary(pathview)\nlibrary(gageData)\nlibrary(TFEA.ChIP)              # analyze transcription factor enrichment in a gene set\nlibrary(BiocParallel)           # speed up some parallelizeable processing\nregister(MulticoreParam(4))     # set core parallelization to 4 CPU cores\ntheme_set(theme_bw())           # set the default ggplot theme to be clear & cartooney"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#notes-on-approach",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#notes-on-approach",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "",
    "text": "The GTEx Consortium atlas of genetic regulatory effects across human tissues The Genotype-Tissue Expression (GTEx) project was established to characterize genetic effects on the transcriptome across human tissues and to link these regulatory mechanisms to trait and disease associations.\nI’m interpreting “specific to the liver” to mean uniquely expressed in the liver compared to each other tissue in scope. I will express this in the analysis by running instructing DEseq to run a one-to-many test by ranking liver first among the tissue factors, and then running a p-value meta-analysis on the p-value results for features (protein-coding genes) in all comparisons. (Meaning, it only takes one liver-to-tissue comparison revealing that a gene is NOT up-regulated in the liver to remove that gene from consideration.)"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#patricks-hypothesis",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#patricks-hypothesis",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "",
    "text": "Given this is liver RNA-seq, I expect to see genes implicated in the liver main roles, namely:\n\nconditioning the blood by secreting important proteins into it, like serum albumin, immune complement proteins, C-reactive protein, clotting factors (pre-pro-thrombin, fibrinogen, plasminogen), etc.\ncytochrome P450 proteins (CYPxxx), by which the liver catabolizes xenobiotics\nglycolysis, gluconeogenesis, and fatty acid catabolism\nbile salts catabolism and anabolism (cholesterols, hemoglobin/porphyrin)\namino acid conversion and catabolism\n\n\nlibrary(usethis)\nlibrary(readr)                  # for reading and writing csvs\nlibrary(fs)                     # for filesystem navigation in R\nlibrary(dplyr)                  # for dataframe manipulation\nlibrary(tidyr)                  # for dataframe group nesting and manipulation\nlibrary(purrr)                  # for functional programming, including on nested dataframes\nlibrary(readxl)                 # for reading excel files\nlibrary(stringr)                # for efficient string manipulation\nlibrary(magrittr)               # for enhanced pipes\nlibrary(broom)                  # for model manipulation\nlibrary(forcats)                # for factor manipulation\nlibrary(ggplot2)                # for additional plotting features\nlibrary(ensembldb)\nlibrary(DESeq2)\nlibrary(AnnotationDbi)\nlibrary(org.Hs.eg.db)\nlibrary(gage)\nlibrary(pathview)\nlibrary(gageData)\nlibrary(TFEA.ChIP)              # analyze transcription factor enrichment in a gene set\nlibrary(BiocParallel)           # speed up some parallelizeable processing\nregister(MulticoreParam(4))     # set core parallelization to 4 CPU cores\ntheme_set(theme_bw())           # set the default ggplot theme to be clear & cartooney"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#filter-sample-table-to-our-scoped-tissue-types",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#filter-sample-table-to-our-scoped-tissue-types",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Filter sample table to our scoped tissue types",
    "text": "Filter sample table to our scoped tissue types\n\ngtex_samples_filtered &lt;- gtex_samples %&gt;%\n  dplyr::filter(tissue_id %in% tissue_keep) %&gt;%\n  # on the next line, set order of factors with liver first\n  mutate(\"tissue_id\" = fct_relevel(as_factor(tissue_id), tissue_keep) )\ndplyr::count(gtex_samples_filtered)\n\n     n\n1 4421\n\n\n4421 / 17382 = .254 . We are keeping ~ 25% of samples that were in GTEx v8.\n\ngtex_samples_filtered %&gt;%\n  dplyr::count(tissue_id) %&gt;%\n  mutate(\"percent\" = signif(n / sum(n) * 100, digits = 2)) %&gt;%\n  arrange(desc(n))\n\n                tissue_id   n percent\n1         Muscle_Skeletal 803   18.00\n2                 Thyroid 653   15.00\n3                    Lung 578   13.00\n4    Heart_Left_Ventricle 432    9.80\n5  Heart_Atrial_Appendage 429    9.70\n6                 Stomach 359    8.10\n7                Pancreas 328    7.40\n8               Pituitary 283    6.40\n9                  Spleen 241    5.50\n10                  Liver 226    5.10\n11          Kidney_Cortex  85    1.90\n12         Kidney_Medulla   4    0.09"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#import-the-related-bulk-rnaseq-counts",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#import-the-related-bulk-rnaseq-counts",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Import the related bulk RNAseq counts",
    "text": "Import the related bulk RNAseq counts\nBulk RNAseq gct files came from: https://www.gtexportal.org/home/downloads/adult-gtex\nI’ll use read counts because that’s what DEseq2’s statistical modeling requires. Unzip it first:\n\ncd ..\ngunzip *.gz\n\n\nrna_counts &lt;- read.delim(\"../../bulk-gex_v8_rna-seq_GTEx_Analysis_2017-06-05_v8_RNASeQCv1.1.9_gene_reads.gct\",\n                         sep = \"\\t\", skip = 2) %&gt;%\n  tibble::column_to_rownames(var = \"Name\")\n\n\nTroubleshoot filtering samples/matrix columns\n\nrna_counts_cols &lt;- colnames(rna_counts)\n\n\nlength(gtex_samples_filtered[['sample_id']] %in% rna_counts_cols)\n\n[1] 4421\n\n\n\nanti_join(gtex_samples_filtered, as_tibble(rna_counts_cols),\n          by = c(\"sample_id\" = \"value\"))\n\n[1] sample_id    donor_id     has_genotype tissue_id   \n&lt;0 rows&gt; (or 0-length row.names)\n\n\n0 is the desired outcome of an anti-join.\n\nrna_counts_filtered &lt;- rna_counts %&gt;%\n  dplyr::select(gtex_samples_filtered[['sample_id']]) %&gt;%\n  as.matrix()\n\n\ndim(rna_counts_filtered)\n\n[1] 56200  4421\n\n\nGreat: filtering went correctly. The dashes-to-periods issue was irksome. We have y = 4421 samples, and 56200 features.\n\nall(gtex_samples_filtered[['sample_id']] %in% colnames(rna_counts_filtered))\n\n[1] TRUE\n\n\n\nall(gtex_samples_filtered[['sample_id']] == colnames(rna_counts_filtered))\n\n[1] TRUE\n\n\nGreat, we are good to continue to DEseq2 DESeqDataSet"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#filter-features-to-protein-coding-genes",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#filter-features-to-protein-coding-genes",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Filter features to protein-coding genes",
    "text": "Filter features to protein-coding genes\nplease restrict your analyses to protein-coding genes and the following tissues:\n\nkeytypes(org.Hs.eg.db)\n\n [1] \"ACCNUM\"       \"ALIAS\"        \"ENSEMBL\"      \"ENSEMBLPROT\"  \"ENSEMBLTRANS\"\n [6] \"ENTREZID\"     \"ENZYME\"       \"EVIDENCE\"     \"EVIDENCEALL\"  \"GENENAME\"    \n[11] \"GENETYPE\"     \"GO\"           \"GOALL\"        \"IPI\"          \"MAP\"         \n[16] \"OMIM\"         \"ONTOLOGY\"     \"ONTOLOGYALL\"  \"PATH\"         \"PFAM\"        \n[21] \"PMID\"         \"PROSITE\"      \"REFSEQ\"       \"SYMBOL\"       \"UCSCKG\"      \n[26] \"UNIPROT\"     \n\n\n\nensgs_to_filter &lt;- tibble(\"ENSG\" = dimnames(rna_counts_filtered)[[1]])\n\n\nensgs_filtered_protein &lt;- ensgs_to_filter %&gt;%\n  mutate(\"short_ensg\" = str_remove(ENSG, \"(?&lt;=ENSG\\\\d{1,14})\\\\.{0,1}\\\\d{0,3}$\"),\n         \"genetype\" = mapIds(org.Hs.eg.db,\n                           keys = short_ensg,\n                           column = \"GENETYPE\",\n                           keytype = \"ENSEMBL\",\n                           multiVals = \"first\"))\n\n'select()' returned 1:many mapping between keys and columns\n\ndplyr::count(ensgs_filtered_protein, genetype) %&gt;% arrange(desc(n))\n\n# A tibble: 10 × 2\n   genetype           n\n   &lt;chr&gt;          &lt;int&gt;\n 1 &lt;NA&gt;           21144\n 2 protein-coding 19198\n 3 pseudo          8918\n 4 ncRNA           5820\n 5 snoRNA           654\n 6 other            368\n 7 snRNA             75\n 8 rRNA              20\n 9 scRNA              2\n10 unknown            1\n\nensgs_filtered_protein &lt;- dplyr::filter(ensgs_filtered_protein, genetype == \"protein-coding\")\n\nActually apply the filter below\n\nrna_counts_filtered &lt;- rna_counts_filtered[ensgs_filtered_protein[[1]], ]\ndim(rna_counts_filtered)\n\n[1] 19198  4421\n\n\n\nNumber of features\n\ndplyr::count(ensgs_to_filter)[[1]]\n\n[1] 56200\n\n\n19184/56200 = 34%, so we are keeping 34% of features in the counts matrix, because ENSEMBL annotates them as protein-coding. Thus we are jettisoning 66% of features as being non-protein coding. What the ENCODE db indicates is that annotated ENCODE entries are the most common, followed by pseudo, ncRNA, snoRNA, “other,” snRNA, rRNA, scRNA, and “unknown.”"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#prepare-data-object-for-deseq2",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#prepare-data-object-for-deseq2",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Prepare data object for DEseq2",
    "text": "Prepare data object for DEseq2\n\ntissue_DE &lt;- DESeqDataSetFromMatrix(countData = rna_counts_filtered,\n                              colData = gtex_samples_filtered,\n                              design = ~ tissue_id)\ntissue_DE\n\nclass: DESeqDataSet \ndim: 19198 4421 \nmetadata(1): version\nassays(1): counts\nrownames(19198): ENSG00000186092.4 ENSG00000187634.11 ...\n  ENSG00000198695.2 ENSG00000198727.2\nrowData names(0):\ncolnames(4421): GTEX.1117F.0426.SM.5EGHI GTEX.1117F.0726.SM.5GIEN ...\n  GTEX.ZZPU.1426.SM.5GZZ6 GTEX.ZZPU.2626.SM.5E45Y\ncolData names(4): sample_id donor_id has_genotype tissue_id\n\n\n\nFilter for minimum counts\nFilter for features (genes) where there are less than 113 or more samples with normalized counts greater than or equal to 5. (113 is half the number of liver samples in the data, allowing for at least some dispersion in at least among the samples of the tissue type we want to understand.)\n\ntissue_DE &lt;- estimateSizeFactors(tissue_DE)\nidx &lt;- rowSums( counts(tissue_DE, normalized = TRUE) &gt;= 5 ) &gt;= 113\n\n\ntissue_DE &lt;- tissue_DE[idx,]\ndim(tissue_DE)\n\n[1] 18023  4421\n\n\n\n(56200-33387);\n\n[1] 22813\n\n(56200-33387)/56200\n\n[1] 0.4059253\n\n(19184-18013)/19184\n\n[1] 0.06104045\n\n\nOriginally, when filtering for features with a minimum number of counts over the minimum number of genes, I filtered out 22,813 (40.6%) based on low counts / coverage. However, now the I’m filtering genes for counts after filtering for protein coding genes, only 6.1% of features are dropped. This difference in proportionality indicates that low count features and protein coding genes are not necessarily independent. In fact, the non-protein-coding features were enriched for low expression levels across many of the samples."
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#run-deseq2-analysis-1",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#run-deseq2-analysis-1",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Run DEseq2 analysis",
    "text": "Run DEseq2 analysis\n\nrm(gtex_samples, gtex_samples_filtered, rna_counts_filtered, rna_counts)\n\n\ntissue_DE &lt;- DESeq(tissue_DE)\n\nusing pre-existing size factors\n\n\nestimating dispersions\n\n\ngene-wise dispersion estimates\n\n\nmean-dispersion relationship\n\n\nfinal dispersion estimates\n\n\nfitting model and testing\n\n\n-- replacing outliers and refitting for 237 genes\n-- DESeq argument 'minReplicatesForReplace' = 7 \n-- original counts are preserved in counts(dds)\n\n\nestimating dispersions\n\n\nfitting model and testing\n\n\n\ncontrasts_no_intercept &lt;- resultsNames(tissue_DE)[2:length(resultsNames(tissue_DE))]\ncontrasts_no_intercept\n\n [1] \"tissue_id_Heart_Left_Ventricle_vs_Liver\"  \n [2] \"tissue_id_Heart_Atrial_Appendage_vs_Liver\"\n [3] \"tissue_id_Kidney_Cortex_vs_Liver\"         \n [4] \"tissue_id_Kidney_Medulla_vs_Liver\"        \n [5] \"tissue_id_Lung_vs_Liver\"                  \n [6] \"tissue_id_Muscle_Skeletal_vs_Liver\"       \n [7] \"tissue_id_Pancreas_vs_Liver\"              \n [8] \"tissue_id_Spleen_vs_Liver\"                \n [9] \"tissue_id_Stomach_vs_Liver\"               \n[10] \"tissue_id_Pituitary_vs_Liver\"             \n[11] \"tissue_id_Thyroid_vs_Liver\"               \n\n\n\nExtract all contrast data from DEseq\n\ncombine_contrast_results &lt;- function(deseq_obj){\n  \n  contrasts_no_intercept &lt;- resultsNames(deseq_obj)[2:length(resultsNames(deseq_obj))]\n  \n  bind_rows(purrr::map(contrasts_no_intercept, ~ mutate(\n    tibble::rownames_to_column(as.data.frame(results(deseq_obj, name = .x)),\n                               \"ENSG\"),\n    \"contrast\" = .x)\n    )\n  )\n}\n\n\ntissue_DE_results_long &lt;- combine_contrast_results(tissue_DE) %&gt;%\n  mutate(\"contrast\" = str_remove(contrast, \"^tissue_id_\"))\n\ndplyr::count(tissue_DE_results_long, contrast)\n\n                          contrast     n\n1  Heart_Atrial_Appendage_vs_Liver 18023\n2    Heart_Left_Ventricle_vs_Liver 18023\n3           Kidney_Cortex_vs_Liver 18023\n4          Kidney_Medulla_vs_Liver 18023\n5                    Lung_vs_Liver 18023\n6         Muscle_Skeletal_vs_Liver 18023\n7                Pancreas_vs_Liver 18023\n8               Pituitary_vs_Liver 18023\n9                  Spleen_vs_Liver 18023\n10                Stomach_vs_Liver 18023\n11                Thyroid_vs_Liver 18023"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#prepare-data-with-additional-annotations",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#prepare-data-with-additional-annotations",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Prepare data with additional annotations",
    "text": "Prepare data with additional annotations\n\nCheck if ENSG string manipulation prodcuces unique values\n\ndplyr::count(as_tibble(str_remove(row.names(tissue_DE_results_long),\n           \"(?&lt;=ENSG\\\\d{1,14})\\\\.{0,1}\\\\d{0,3}$\")), value) %&gt;%\n  dplyr::count(n);\n\n# A tibble: 1 × 2\n      n     nn\n  &lt;int&gt;  &lt;int&gt;\n1     1 198253\n\ndplyr::count(as_tibble(row.names(tissue_DE_results_long)), value) %&gt;%\n  dplyr::count(n)\n\n# A tibble: 1 × 2\n      n     nn\n  &lt;int&gt;  &lt;int&gt;\n1     1 198253\n\n\n\ntissue_DE_results_long &lt;- tissue_DE_results_long %&gt;%\n  mutate(\"short_ensg\" = str_remove(ENSG, \"(?&lt;=ENSG\\\\d{1,14})\\\\.{0,1}\\\\d{0,3}$\"),\n         \"symbol\" = mapIds(org.Hs.eg.db,\n                           keys = short_ensg,\n                           column = \"SYMBOL\",\n                           keytype = \"ENSEMBL\",\n                           multiVals = \"first\"),\n         \"entrez\" = mapIds(org.Hs.eg.db,\n                           keys = short_ensg,\n                           column = \"ENTREZID\",\n                           keytype = \"ENSEMBL\",\n                           multiVals = \"first\"),\n         \"name\" = mapIds(org.Hs.eg.db,\n                         keys = short_ensg,\n                         column = \"GENENAME\",\n                         keytype = \"ENSEMBL\",\n                         multiVals = \"first\")\n         )\n\n'select()' returned 1:many mapping between keys and columns\n'select()' returned 1:many mapping between keys and columns\n'select()' returned 1:many mapping between keys and columns\n\n\n\n\nFurther explore the contrasts\n\ntop_10_hits_summary &lt;- tissue_DE_results_long %&gt;%\n  mutate(\"log2FoldChange\" = -1*log2FoldChange) %&gt;%\n  group_by(contrast) %&gt;%\n  arrange(stat, log2FoldChange) %&gt;%\n  slice_head(n = 10) %&gt;%\n  relocate(\"contrast\", \"short_ensg\", \"symbol\", \"entrez\", \"name\", \"log2FoldChange\")\n\ntop_10_hits_summary %&gt;% dplyr::select(\"contrast\", \"symbol\", \"name\", \"log2FoldChange\")\n\n# A tibble: 110 × 4\n# Groups:   contrast [11]\n   contrast                        symbol  name                   log2FoldChange\n   &lt;chr&gt;                           &lt;chr&gt;   &lt;chr&gt;                           &lt;dbl&gt;\n 1 Heart_Atrial_Appendage_vs_Liver SLC27A5 solute carrier family…           7.77\n 2 Heart_Atrial_Appendage_vs_Liver RDH16   retinol dehydrogenase…           9.76\n 3 Heart_Atrial_Appendage_vs_Liver SLC22A1 solute carrier family…          11.8 \n 4 Heart_Atrial_Appendage_vs_Liver CYP2E1  cytochrome P450 famil…          11.5 \n 5 Heart_Atrial_Appendage_vs_Liver ASGR1   asialoglycoprotein re…          10.1 \n 6 Heart_Atrial_Appendage_vs_Liver CYP2D6  cytochrome P450 famil…           8.74\n 7 Heart_Atrial_Appendage_vs_Liver CPS1    carbamoyl-phosphate s…           8.98\n 8 Heart_Atrial_Appendage_vs_Liver APOM    apolipoprotein M                 7.20\n 9 Heart_Atrial_Appendage_vs_Liver ATF5    activating transcript…           7.22\n10 Heart_Atrial_Appendage_vs_Liver MST1    macrophage stimulatin…           7.25\n# ℹ 100 more rows\n\n\nThis is looking promising. When sorted by statistic and the top ten genes are displayed from each tissue, there are many common genes that are relatively up-regulated (in mRNA expression) in liver compared to each of the other tissues. SLC27A5 is very commonly (and very strongly) up-regulated in liver; RDH16 and CPS1 are as well.\n\n\nMA Plot (analysis QC)\n\nma_plot &lt;- tissue_DE_results_long %&gt;%\n  ggplot(aes(y = log2FoldChange, x = baseMean)) +\n  geom_point(alpha = 0.1, size = .1) +\n  geom_density_2d() +\n  stat_smooth(formula = y ~ x, method = lm, color = \"yellow\", linewidth = 0.3) +\n  scale_x_log10() +\n  labs(title = \"MA-plot: a scatter plot of log2 fold changes\",\n       x = \"mean of normalized counts\",\n       y = \"log2 fold change\") +\n  facet_wrap(~ contrast)\nma_plot\n\n\n\n\nFor all contrasts, the data points (gene IDs) are roughly symmetric around the x-axis (indicating no systematic bias), and the majority are close to the x-axis, indicating many genes are not differentially expressed.\n\nma_hist &lt;- tissue_DE_results_long %&gt;%\n  ggplot(aes(log2FoldChange)) +\n  geom_histogram(binwidth = 1) +\n  labs(title = \"MA-plot: histogram of log2 fold changes\",\n       y = \"number of genes\",\n       x = \"log2 fold change\") +\n  facet_wrap(~ contrast)\nma_hist\n\n\n\n\n\nma_hist_stats &lt;- tissue_DE_results_long %&gt;%\n  group_by(contrast) %&gt;%\n  dplyr::summarize(\"mean log2FoldChange\" = mean(log2FoldChange),\n                   \"S.D. log2FoldChange\" = sd(log2FoldChange),\n                   \"n features\" = n())\nma_hist_stats\n\n# A tibble: 11 × 4\n   contrast             `mean log2FoldChange` `S.D. log2FoldChange` `n features`\n   &lt;chr&gt;                                &lt;dbl&gt;                 &lt;dbl&gt;        &lt;int&gt;\n 1 Heart_Atrial_Append…               -0.0807                  2.49        18023\n 2 Heart_Left_Ventricl…               -0.160                   2.53        18023\n 3 Kidney_Cortex_vs_Li…                0.120                   2.10        18023\n 4 Kidney_Medulla_vs_L…               -0.0501                  2.29        18023\n 5 Lung_vs_Liver                       0.134                   2.37        18023\n 6 Muscle_Skeletal_vs_…               -0.342                   2.77        18023\n 7 Pancreas_vs_Liver                  -0.0455                  2.21        18023\n 8 Pituitary_vs_Liver                  0.229                   2.69        18023\n 9 Spleen_vs_Liver                    -0.156                   2.36        18023\n10 Stomach_vs_Liver                    0.112                   2.27        18023\n11 Thyroid_vs_Liver                   -0.0922                  2.37        18023\n\n\nAs a clearer summary plot, the histograms for each contrast a preponderance of genes are close to the 0 on the x-axis, indicating many features have limited fold change between samples.\n\nstat_hist &lt;- tissue_DE_results_long %&gt;%\n  ggplot(aes(stat)) +\n  geom_histogram(bins = 40) +\n  labs(title = \"Stat (statistic)\",\n       y = \"number of genes\",\n       x = \"Statistic\") +\n  facet_wrap(~ contrast)\nstat_hist\n\n\n\n\nWhile the test statistic outputted by DEseq2 is less “clipped” to zero than the p-values (many of which exhaust the range and get reported as 0.000000e+00), the statistic range/distribution is not the same for all contrasts, notably for the Kidney Medulla vs Liver comparison. This can be explained from the Filter sample table to our scoped tissue types section of this document, which shows the Kidney Medulla GTEx tissue set as having far fewer samples (n = 4) than the other tissue types (mean = 368, sd = 230).\nAs long as we group_by() when ranking, sorting, and otherwise comparing (in long format), this should be okay. Once pivoted into wide format, this can present a problem because not every column of values will be able to react similarly to the same ranking, sorting, or cut-offs."
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#summarize-by-feature",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#summarize-by-feature",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Summarize by feature",
    "text": "Summarize by feature\nWhich is effectively a wide format, appropriate for joining. (Grouped-by calculations in the same column run more efficiently and are easier to program than row-wise multi-column calculations.\n\ntissue_DE_results_feature_summary &lt;- tissue_DE_results_long %&gt;%\n  summarize(across(.cols = c(\"log2FoldChange\", \"stat\"),\n                   .fns = c(\"mean\" = mean, \"sd\" = sd,\n                            \"below_zero_min\" = ~ min( (.x[.x &lt;0]) ) ),\n                   .names = \"{.fn}_{.col}\"),\n            across(.cols = c(\"lfcSE\", \"pvalue\", \"padj\"),\n                   .fns = c(\"mean\" = mean, \"sd\" = sd,\n                            \"min\" = min),\n                   .names = \"{.fn}_{.col}\"),\n            .by = c(\"ENSG\", \"short_ensg\", \"symbol\", \"entrez\", \"name\"))\n\nWarning: There were 4798 warnings in `summarize()`.\nThe first warning was:\nℹ In argument: `across(...)`.\nℹ In group 7: `ENSG = \"ENSG00000188290.10\"`, `short_ensg = \"ENSG00000188290\"`,\n  `symbol = \"HES4\"`, `entrez = \"57801\"`, `name = \"hes family bHLH transcription\n  factor 4\"`.\nCaused by warning in `min()`:\n! no non-missing arguments to min; returning Inf\nℹ Run `dplyr::last_dplyr_warnings()` to see the 4797 remaining warnings.\n\n\nTo explain why I’m contriving these summary statistics, I have to first acknowledge that downstream processing (GO analysis, TF.ChIP) expects continuous data ( e.g. log2FoldChange, adj.p.val) for both the up-regulated and down-regulated features. Thus, in drawing conclusions from the comparisons, I am balancing maintaining continuous variables that can be used later with summary statistics that suggest consistency across all the tissue type comparisons made (and in the case of the highly confident features/genes, these suggestive consistency metrics indicate high levels of agreement).\nThese metrics are the mean_log2FoldChange, sd_log2FoldChange, and the below_zero_min_log2FoldChange, (as well as these versions on stat and padj). Together, these continuous feature summary metrics describe how consistently the metrics are across comparisons (e.g. liver to thyroid, liver to lung, etc.). When a feature is specific to the liver, the mean will be negative and large, the sd will be smaller than the mean, and the min_below_zero will not be far away from the mean. Such an outcome indicates that all the comparisons agree that a gene is specifically up-regulated in the liver compared to all other tissues considered here.\nApplying these summary transformations to the log2FoldChange, pvalue, and padj are reasonable because these metrics either do not depend on the number of samples (log2FoldChange), or account for the number of samples in the condition (pvalue, and padj), explicitly allowing for comparisons between conditions."
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#pivot-to-wide",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#pivot-to-wide",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Pivot to wide",
    "text": "Pivot to wide\n\ntissue_DE_results_wide &lt;- tissue_DE_results_long %&gt;%\n  pivot_wider(id_cols = c(\"ENSG\", \"short_ensg\", \"symbol\", \"entrez\", \"name\"),\n              names_from = \"contrast\",\n              values_from = c(\"baseMean\", \"log2FoldChange\", \"lfcSE\", \"stat\", \"pvalue\", \"padj\")) %&gt;%\n  left_join(tissue_DE_results_feature_summary,\n            by = c(\"ENSG\", \"short_ensg\", \"symbol\", \"entrez\", \"name\")) %&gt;%\n  relocate(short_ensg, mean_log2FoldChange, mean_stat, symbol, name,\n           sd_log2FoldChange, below_zero_min_log2FoldChange, sd_stat, below_zero_min_stat, mean_lfcSE,\n           sd_lfcSE, min_lfcSE, mean_pvalue, sd_pvalue, min_pvalue, mean_padj, sd_padj, min_padj) %&gt;%\n  arrange(mean_padj, mean_log2FoldChange)"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#pathway-analysis",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#pathway-analysis",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Pathway analysis",
    "text": "Pathway analysis\nwith GAGE\n\nPrepare GAGE’s needed data\n\ndata(kegg.sets.hs)\ndata(sigmet.idx.hs)\nkegg.sets.hs = kegg.sets.hs[sigmet.idx.hs]\n\n\n\nPerpare DEseq2 result for GAGE\n\nfoldchanges = tissue_DE_results_wide$mean_log2FoldChange\nnames(foldchanges) = tissue_DE_results_wide$entrez\nhead(foldchanges)\n\n     10998       8608       1373          1        432       1571 \n -7.601432  -9.367489  -9.478086  -8.152599  -9.564476 -10.454284"
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#run-gage",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#run-gage",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "Run GAGE",
    "text": "Run GAGE\n\nkeggres = gage(foldchanges, gsets = kegg.sets.hs, same.dir = TRUE)\n\n\nView Results\nRemember that “down-regulated” (i.e. the “$less” table) is up-regulated in liver, due to the DEseq contrasts.\n\nas.data.frame(head(keggres$less, 20)) %&gt;%\n  dplyr::select(\"p.geomean\", \"stat.mean\", \"p.val\", \"set.size\")\n\n                                                         p.geomean stat.mean\nhsa00830 Retinol metabolism                           2.779302e-15 -9.570937\nhsa00982 Drug metabolism - cytochrome P450            1.480851e-13 -8.552116\nhsa00980 Metabolism of xenobiotics by cytochrome P450 3.742583e-12 -7.909573\nhsa00140 Steroid hormone biosynthesis                 7.829862e-12 -7.983659\nhsa00983 Drug metabolism - other enzymes              3.227821e-11 -7.785412\nhsa04610 Complement and coagulation cascades          1.590346e-10 -7.112879\nhsa00260 Glycine, serine and threonine metabolism     8.543084e-08 -6.071404\nhsa00053 Ascorbate and aldarate metabolism            3.398045e-07 -6.247136\nhsa04146 Peroxisome                                   3.456134e-07 -5.215038\nhsa00071 Fatty acid metabolism                        8.363970e-07 -5.220379\nhsa00040 Pentose and glucuronate interconversions     8.446235e-07 -5.659101\nhsa00860 Porphyrin and chlorophyll metabolism         3.474540e-06 -4.994513\nhsa00500 Starch and sucrose metabolism                5.047958e-06 -4.774060\nhsa00380 Tryptophan metabolism                        1.180799e-05 -4.535570\nhsa00280 Valine, leucine and isoleucine degradation   2.437705e-05 -4.277734\nhsa03320 PPAR signaling pathway                       4.831137e-05 -4.070571\nhsa04976 Bile secretion                               5.608401e-05 -4.037952\nhsa04975 Fat digestion and absorption                 8.538313e-05 -4.013194\nhsa00120 Primary bile acid biosynthesis               1.087369e-04 -4.465205\nhsa00591 Linoleic acid metabolism                     1.465698e-04 -4.016737\n                                                             p.val set.size\nhsa00830 Retinol metabolism                           2.779302e-15       60\nhsa00982 Drug metabolism - cytochrome P450            1.480851e-13       68\nhsa00980 Metabolism of xenobiotics by cytochrome P450 3.742583e-12       66\nhsa00140 Steroid hormone biosynthesis                 7.829862e-12       52\nhsa00983 Drug metabolism - other enzymes              3.227821e-11       48\nhsa04610 Complement and coagulation cascades          1.590346e-10       69\nhsa00260 Glycine, serine and threonine metabolism     8.543084e-08       32\nhsa00053 Ascorbate and aldarate metabolism            3.398045e-07       22\nhsa04146 Peroxisome                                   3.456134e-07       78\nhsa00071 Fatty acid metabolism                        8.363970e-07       43\nhsa00040 Pentose and glucuronate interconversions     8.446235e-07       28\nhsa00860 Porphyrin and chlorophyll metabolism         3.474540e-06       38\nhsa00500 Starch and sucrose metabolism                5.047958e-06       50\nhsa00380 Tryptophan metabolism                        1.180799e-05       42\nhsa00280 Valine, leucine and isoleucine degradation   2.437705e-05       44\nhsa03320 PPAR signaling pathway                       4.831137e-05       70\nhsa04976 Bile secretion                               5.608401e-05       70\nhsa04975 Fat digestion and absorption                 8.538313e-05       44\nhsa00120 Primary bile acid biosynthesis               1.087369e-04       16\nhsa00591 Linoleic acid metabolism                     1.465698e-04       28\n\n\nWhat’s down-regulated in liver compared to other tissues in the scope of our analysis?\n\nas.data.frame(head(keggres$greater, 30)) %&gt;%\n  dplyr::select(\"p.geomean\", \"stat.mean\", \"p.val\", \"set.size\")\n\n                                                            p.geomean stat.mean\nhsa04260 Cardiac muscle contraction                      4.226923e-05 4.0485435\nhsa04510 Focal adhesion                                  8.259292e-05 3.8042688\nhsa04020 Calcium signaling pathway                       4.162904e-04 3.3711847\nhsa04971 Gastric acid secretion                          4.992403e-04 3.3629267\nhsa04540 Gap junction                                    2.260177e-03 2.8795191\nhsa04512 ECM-receptor interaction                        1.063049e-02 2.3255222\nhsa00512 Mucin type O-Glycan biosynthesis                1.216786e-02 2.3178456\nhsa04310 Wnt signaling pathway                           1.365917e-02 2.2195968\nhsa04010 MAPK signaling pathway                          1.744611e-02 2.1151954\nhsa04740 Olfactory transduction                          1.772474e-02 2.1215169\nhsa04144 Endocytosis                                     1.777223e-02 2.1102663\nhsa04360 Axon guidance                                   2.267218e-02 2.0114316\nhsa04810 Regulation of actin cytoskeleton                2.364352e-02 1.9896259\nhsa04070 Phosphatidylinositol signaling system           4.524492e-02 1.7041613\nhsa04742 Taste transduction                              4.633911e-02 1.7021996\nhsa04666 Fc gamma R-mediated phagocytosis                5.200086e-02 1.6354382\nhsa00603 Glycosphingolipid biosynthesis - globo series   5.488970e-02 1.6593014\nhsa04916 Melanogenesis                                   6.589814e-02 1.5133803\nhsa04960 Aldosterone-regulated sodium reabsorption       7.526569e-02 1.4512416\nhsa04970 Salivary secretion                              7.787444e-02 1.4259650\nhsa04966 Collecting duct acid secretion                  9.503669e-02 1.3287755\nhsa04720 Long-term potentiation                          1.029612e-01 1.2717035\nhsa04722 Neurotrophin signaling pathway                  1.100257e-01 1.2305044\nhsa04012 ErbB signaling pathway                          1.306016e-01 1.1275055\nhsa00604 Glycosphingolipid biosynthesis - ganglio series 1.335755e-01 1.1341217\nhsa04730 Long-term depression                            1.385772e-01 1.0911743\nhsa04330 Notch signaling pathway                         1.424131e-01 1.0774613\nhsa04962 Vasopressin-regulated water reabsorption        1.465997e-01 1.0579484\nhsa03010 Ribosome                                        1.579659e-01 1.0084071\nhsa00562 Inositol phosphate metabolism                   1.619384e-01 0.9910218\n                                                                p.val set.size\nhsa04260 Cardiac muscle contraction                      4.226923e-05       76\nhsa04510 Focal adhesion                                  8.259292e-05      200\nhsa04020 Calcium signaling pathway                       4.162904e-04      176\nhsa04971 Gastric acid secretion                          4.992403e-04       73\nhsa04540 Gap junction                                    2.260177e-03       88\nhsa04512 ECM-receptor interaction                        1.063049e-02       84\nhsa00512 Mucin type O-Glycan biosynthesis                1.216786e-02       30\nhsa04310 Wnt signaling pathway                           1.365917e-02      148\nhsa04010 MAPK signaling pathway                          1.744611e-02      262\nhsa04740 Olfactory transduction                          1.772474e-02       97\nhsa04144 Endocytosis                                     1.777223e-02      201\nhsa04360 Axon guidance                                   2.267218e-02      129\nhsa04810 Regulation of actin cytoskeleton                2.364352e-02      209\nhsa04070 Phosphatidylinositol signaling system           4.524492e-02       78\nhsa04742 Taste transduction                              4.633911e-02       43\nhsa04666 Fc gamma R-mediated phagocytosis                5.200086e-02       93\nhsa00603 Glycosphingolipid biosynthesis - globo series   5.488970e-02       14\nhsa04916 Melanogenesis                                   6.589814e-02       99\nhsa04960 Aldosterone-regulated sodium reabsorption       7.526569e-02       42\nhsa04970 Salivary secretion                              7.787444e-02       85\nhsa04966 Collecting duct acid secretion                  9.503669e-02       27\nhsa04720 Long-term potentiation                          1.029612e-01       69\nhsa04722 Neurotrophin signaling pathway                  1.100257e-01      127\nhsa04012 ErbB signaling pathway                          1.306016e-01       87\nhsa00604 Glycosphingolipid biosynthesis - ganglio series 1.335755e-01       15\nhsa04730 Long-term depression                            1.385772e-01       68\nhsa04330 Notch signaling pathway                         1.424131e-01       47\nhsa04962 Vasopressin-regulated water reabsorption        1.465997e-01       43\nhsa03010 Ribosome                                        1.579659e-01       87\nhsa00562 Inositol phosphate metabolism                   1.619384e-01       57\n\n\nNote that the p-values for pathways down-regulated in the liver are less significant than those of pathways up-regulated, likely due to by high dispersion among the comparison tissues.\n\n\nPathway plots\n\nkeggrespathways &lt;- data.frame(id = rownames(keggres$less), keggres$less) %&gt;% \n  as_tibble() %&gt;%\n  dplyr::slice_head(n = 5) %&gt;% \n  .$id %&gt;% \n  as.character() %&gt;%\n  # top 5, plus some pet pathways part of my starting hypothesis\n  append(\"hsa04976 Bile secretion\") %&gt;%\n  append(\"hsa00860 Porphyrin and chlorophyll metabolism\") %&gt;%\n  append(\"hsa00280 Valine, leucine and isoleucine degradation\")\n\nkeggresids = str_sub(keggrespathways, start = 1, end = 8)\n\nkeggrespathways\n\n[1] \"hsa00830 Retinol metabolism\"                          \n[2] \"hsa00982 Drug metabolism - cytochrome P450\"           \n[3] \"hsa00980 Metabolism of xenobiotics by cytochrome P450\"\n[4] \"hsa00140 Steroid hormone biosynthesis\"                \n[5] \"hsa00983 Drug metabolism - other enzymes\"             \n[6] \"hsa04976 Bile secretion\"                              \n[7] \"hsa00860 Porphyrin and chlorophyll metabolism\"        \n[8] \"hsa00280 Valine, leucine and isoleucine degradation\"  \n\n\n\n# Define plotting function for applying later\nplot_pathway &lt;- function(pid) {pathview(gene.data = foldchanges,\n                                        pathway.id = pid, species = \"hsa\", new.signature = FALSE)}\n\n# plot multiple pathways (plots saved to disk and returns a throwaway list object)\ntmp = sapply(keggresids, plot_pathway)\n\nTypically, expression heat maps use the color-blind-unfriendly and unintuitive red for up-regulated expression, and green for decreased expression.\nHowever, here, because I never inverted (multiplied by -1) the log2-fold-change values, green is for increased relative expression, and red is for decreased relative expression.\n\nhsa00830 Retinol metabolism\n\n\n\nhsa00830 Retinol metabolism\n\n\n\n\nhsa00982 Drug metabolism - cytochrome P450\n\n\n\nhsa00982 Drug metabolism - cytochrome P450\n\n\n\n\nhsa00980 Metabolism of xenobiotics by cytochrome P450\n\n\n\nhsa00980 Metabolism of xenobiotics by cytochrome P450\n\n\n\n\nhsa00983 Drug metabolism - other enzymes\n\n\n\nhsa00983 Drug metabolism - other enzymes\n\n\n\n\nhsa00140 Steroid hormone biosynthesis\n\n\n\nhsa00140 Steroid hormone biosynthesis\n\n\n\n\nhsa00983 Drug metabolism - other enzymes\n\n\n\nhsa00983 Drug metabolism - other enzymes\n\n\n\n\nhsa04976 Bile secretion\n\n\n\nhsa04976 Bile secretion\n\n\nThe bile secretion graphic is particularly interesting because it depicts spatial regulation across cell types, and those expectations (hypotheses) are upheld by the bulk RNA-seq data from GTEx. Most hepatocyte genes are up-regulated, whereas most cholangiocyte (epithelial cells of the bile duct) genes are not up-regulated.\n\n\nhsa00860 Porphyrin and chlorophyll metabolism\n\n\n\nhsa00860 Porphyrin and chlorophyll metabolism\n\n\nPorphyrin metabolism is a curious case: not many of the GO term’s genes are up-regulated, and even along a linear pathway, not all the genes in are up-regulated. I am especially surprised to see biliverdin to bilirubin conversion down-regulated relative to the other tissues in this set. Meanwhile, two of bilirubin’s downstream steps are up-regulated."
  },
  {
    "objectID": "posts/2024_01_03-GTEX_RNA_seq_liver.html#chip-transcription-factor-data",
    "href": "posts/2024_01_03-GTEX_RNA_seq_liver.html#chip-transcription-factor-data",
    "title": "GTEX RNA-seq Liver-specific Process and TF Identification",
    "section": "ChIP Transcription Factor data",
    "text": "ChIP Transcription Factor data\n\nchip_index &lt;- get_chip_index(encodeFilter = TRUE)\nDE_CM_chip &lt;- contingency_matrix(genes_upreg, #genes_ctrl,\n                                 chip_index = chip_index)\nDE_CM_chip_stats &lt;- getCMstats(DE_CM_chip, chip_index)\n\n\nTF_ranking &lt;- rankTFs(DE_CM_chip_stats, rankMethod = \"gsea\", makePlot = FALSE)\nTF_ranking %&gt;%\n  mutate(\"is_significant\" = if_else(pVal &lt;= 0.05, TRUE, FALSE)) %&gt;%\n  arrange(desc(is_significant), desc(ES), pVal) %&gt;%\n  slice_head(n = 30)\n\n             TF       ES arg.ES pVal numberOfChIPs is_significant\nFOXA2     FOXA2  0.99125      8 0.00             2           TRUE\nHNF1A     HNF1A  0.97817     16 0.01             1           TRUE\nHNF4G     HNF4G  0.97522     19 0.01             2           TRUE\nNR2F6     NR2F6  0.97234     20 0.03             1           TRUE\nHNF4A     HNF4A  0.96642     26 0.00             3           TRUE\nFOXA1     FOXA1  0.94599     40 0.01             3           TRUE\nNR2F2     NR2F2  0.94015     44 0.00             3           TRUE\nATF3       ATF3  0.76196     11 0.02             6           TRUE\nGABPA     GABPA -0.69893    593 0.04             9           TRUE\nCREB1     CREB1 -0.80579    628 0.03             5           TRUE\nSIN3A     SIN3A -0.81379    654 0.05             5           TRUE\nCHD2       CHD2 -0.86508    618 0.00             5           TRUE\nTBP         TBP -0.87588    608 0.01             4           TRUE\nMAZ         MAZ -0.88623    639 0.05             3           TRUE\nELF1       ELF1 -0.90544    627 0.00             5           TRUE\nCBFB       CBFB -0.95049    660 0.03             2           TRUE\nSMAD5     SMAD5 -0.99854    686 0.00             1           TRUE\nNR5A1     NR5A1  0.95779     30 0.08             1          FALSE\nHHEX       HHEX  0.95488     32 0.11             1          FALSE\nGFI1       GFI1  0.95342     33 0.07             1          FALSE\nONECUT1 ONECUT1  0.94905     36 0.09             1          FALSE\nMBD4       MBD4  0.94614     38 0.10             1          FALSE\nSOX13     SOX13  0.94469     39 0.14             1          FALSE\nPAXIP1   PAXIP1  0.93886     43 0.14             1          FALSE\nFOXJ3     FOXJ3  0.93450     46 0.11             1          FALSE\nFOXP1     FOXP1  0.93294     48 0.07             2          FALSE\nATF4       ATF4  0.92868     50 0.10             1          FALSE\nZNF609   ZNF609  0.92576     52 0.18             1          FALSE\nTHRB       THRB  0.92431     53 0.18             1          FALSE\nMED1       MED1  0.91557     59 0.20             1          FALSE\n\n\n\nTFrank_ES_p_plot &lt;- TF_ranking %&gt;% arrange(desc(ES)) %&gt;%\n  mutate(\"rank\" = row_number()) %&gt;%\n  ggplot(aes(y = ES, x = rank, color = pVal)) +\n  geom_point() +\n  scale_color_viridis_c(option = \"D\") +\n  gghighlight::gghighlight(pVal &lt;= .05, #keep_scales = TRUE,\n                           label_key = TF,\n                           unhighlighted_params = list(color = NULL, fill = NULL,\n                                                       size = 0.3, alpha = .5)) +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  coord_cartesian(ylim = c(-1.25, 1.25)) +\n  #scale_x_continuous(trans = \"log1p\") +\n  labs(title = \"Enrichment score by rank, pVal highlighted\",\n       y = \"Enrighment score\",\n       x = \"Rank\",\n       caption = \"Enrichment score of transcription factors by rank. p-values &lt; .05 are highlighted, other TFs are grey.\")\nTFrank_ES_p_plot\n\n\n\n\nNotes on TF_ranking results:\n\nHNF4 (Hepatocyte Nuclear Factor 4) is a nuclear receptor protein mostly expressed in the liver, gut, kidney, and pancreatic beta cells that is critical for liver development.\nForkhead box protein A2 (FOXA2), also known as hepatocyte nuclear factor 3-beta (HNF-3B), is a transcription factor that plays an important role during development\nATF-3 (Cyclic AMP-dependent transcription factor) is an activating member of the mammalian activation transcription factor/cAMP responsive element-binding (CREB) protein family. ATF-3 is induced upon physiological stress in various tissues.\nForkhead box protein A1 (FOXA1), also known as hepatocyte nuclear factor 3-alpha (HNF-3A), is a transcriptional activator for liver-specific transcripts such as albumin and transthyretin, and they also interact with chromatin as a pioneer factor.\nJUND: a functional component of the AP1 transcription factor complex. It has been proposed to protect cells from p53-dependent senescence and apoptosis.\nTAF1 is TFIID subunit 1, a general pol II transcriptional complex component.\nREST: RE1-silencing transcription factor gene encodes a transcriptional repressor which represses neuronal genes in non-neuronal tissues.\nHNF1 homeobox A (hepatocyte nuclear factor 1 homeobox A), also known as HNF1A, is ubiquitously expressed in many tissues and cell types. The protein encoded by this gene is a transcription factor that is highly expressed in the liver and is involved in the regulation of the expression of several liver-specific genes.\n\nThe GSEA option was unhelpful at sorting TFs by the level of evidence to support them (all enrichment scores were 1, and all p-values were 0). Wilcoxon doesn’t make a pretty plot, but it gives us helpful sorting data.\nStill, I’m not impressed by these results. Even with more stringent filtering (log2-fold-change, p-value), I still can’t get a list that looks specific to the liver.\n\nRun GSEA on TFEA.ChIP\n\nGSEA.result[[\"Enrichment.table\"]] %&gt;% dplyr::arrange(`pval.adj`, desc(ES)) %&gt;% slice_head(n = 40) %&gt;%\n  dplyr::select(!c(\"pval.adj\", \"Arg.ES\"))\n\n                    Accession   Cell Treatment      TF      ES p.val\n1     ENCSR297GII.HNF4G.liver  liver             HNF4G 0.54053     0\n2      ENCSR016BMM.TAF1.liver  liver              TAF1 0.49766     0\n3     ENCSR735KEY.FOXA1.liver  liver             FOXA1 0.49263     0\n4   ENCSR000EZP.SREBF1.Hep-G2 Hep-G2            SREBF1 0.48636     0\n5     ENCSR310NYI.FOXA2.liver  liver             FOXA2 0.48343     0\n6     ENCSR324RCI.FOXA1.liver  liver             FOXA1 0.48302     0\n7     ENCSR000BQW.MBD4.Hep-G2 Hep-G2              MBD4 0.47427     0\n8      ENCSR205FOW.ATF3.liver  liver              ATF3 0.47074     0\n9      ENCSR480LIS.ATF3.liver  liver              ATF3 0.47024     0\n10  ENCSR000EVQ.TCF7L2.Hep-G2 Hep-G2            TCF7L2 0.46749     0\n11  ENCSR000EZO.SREBF2.Hep-G2 Hep-G2            SREBF2 0.45675     0\n12   ENCSR516HUP.ZBTB33.liver  liver            ZBTB33 0.45420     0\n13     ENCSR893QWP.REST.liver  liver              REST 0.45235     0\n14    ENCSR080XEY.FOXA2.liver  liver             FOXA2 0.44996     0\n15     ENCSR736BUG.EGR1.liver  liver              EGR1 0.44549     0\n16    ENCSR656JZL.HHEX.Hep-G2 Hep-G2              HHEX 0.44122     0\n17   ENCSR800QIT.HNF1A.Hep-G2 Hep-G2             HNF1A 0.43966     0\n18     ENCSR867WPH.REST.liver  liver              REST 0.43082     0\n19    ENCSR669LCD.ATF4.Hep-G2 Hep-G2              ATF4 0.42999     0\n20    ENCSR000BQX.NFIC.Hep-G2 Hep-G2              NFIC 0.42440     0\n21     ENCSR837GTK.JUND.liver  liver              JUND 0.42418     0\n22     ENCSR196HGZ.JUND.liver  liver              JUND 0.42393     0\n23      ENCSR521IID.MAX.liver  liver               MAX 0.41846     0\n24   ENCSR267DFA.FOXA1.Hep-G2 Hep-G2             FOXA1 0.41741     0\n25 ENCSR887LYD.SMARCC2.Hep-G2 Hep-G2           SMARCC2 0.41697     0\n26     ENCSR290ZOS.EGR1.liver  liver              EGR1 0.40709     0\n27   ENCSR620YNB.KAT2B.Hep-G2 Hep-G2             KAT2B 0.40506     0\n28   ENCSR000BRO.MYBL2.Hep-G2 Hep-G2             MYBL2 0.40453     0\n29   ENCSR345YWJ.ZBTB33.liver  liver            ZBTB33 0.40031     0\n30      ENCSR994YLZ.YY1.liver  liver               YY1 0.39534     0\n31   ENCSR000BVM.NR2F2.Hep-G2 Hep-G2             NR2F2 0.39042     0\n32    ENCSR444LIN.TCF7.Hep-G2 Hep-G2              TCF7 0.38687     0\n33    ENCSR849FVL.GFI1.Hep-G2 Hep-G2              GFI1 0.38592     0\n34   ENCSR029LBT.FOXP1.Hep-G2 Hep-G2             FOXP1 0.38317     0\n35   ENCSR000EEW.ESRRA.Hep-G2 Hep-G2             ESRRA 0.38049     0\n36    ENCSR000BHU.RXRA.Hep-G2 Hep-G2              RXRA 0.37795     0\n37   ENCSR000EEU.HNF4A.Hep-G2 Hep-G2             HNF4A 0.37548     0\n38   ENCSR791AGT.ZNF24.Hep-G2 Hep-G2             ZNF24 0.37417     0\n39   ENCSR413AJG.FOXJ3.Hep-G2 Hep-G2             FOXJ3 0.37378     0\n40     ENCSR000BJX.SP1.Hep-G2 Hep-G2               SP1 0.37328     0\n\n\nThe above table shows that GSEA (in addition to TFEA.ChIP) also returns many liver-implicated transcriptional regulators. The above table is sorted in descending order of effect size (running enrichment score), and also displays the accession ID of the tissue sample that generated the ChIP seq data set. The TFs (transcription factors) can be in the table more than once.\n\nGSEA.result[[\"Enrichment.table\"]] %&gt;% dplyr::count(TF) %&gt;% arrange(desc(n)) %&gt;% slice_head(n = 10)\n\n       TF  n\n1    CTCF 31\n2   EP300 11\n3     MAX 11\n4    JUND 10\n5    REST 10\n6   GABPA  9\n7     MYC  7\n8    TAF1  7\n9  ZBTB33  7\n10   ATF3  6\n\n\nThe above table counts the number of line items for each TF; despite CTCF (a practically ubiquitous transcriptional and chromatin regulator) being so highly represented across data sets, its running effect size was not high enough to make it show up in the top 40 (5.8%) of line items. (Same goes for EP300.)\nWhat this result shows is that the number of ChIP datasets under consideration in this package is not evenly distributed across all potential transcription factors, and so the number of times a transcription factor is identified as a hit is not a good measure of significance or salience."
  },
  {
    "objectID": "posts/2023_12_29-How_I_host_quarto_blog.html",
    "href": "posts/2023_12_29-How_I_host_quarto_blog.html",
    "title": "How I run and deploy this Quarto blog",
    "section": "",
    "text": "I started a blog! Isn’t that grand!?"
  },
  {
    "objectID": "posts/2023_12_29-How_I_host_quarto_blog.html#why-do-i-want-to-blog",
    "href": "posts/2023_12_29-How_I_host_quarto_blog.html#why-do-i-want-to-blog",
    "title": "How I run and deploy this Quarto blog",
    "section": "Why do I want to blog?",
    "text": "Why do I want to blog?\nI’ve always had a lot of thoughts and opinions on many topics. And when I have a thought, idea, or opinion I really want to develop, I often use writing (privately, for myself) as an exercise for exploring, evaluating, and making more rigorous the thought.\n\nWhen I sit down to write a book, I do not say to myself, ‘I am going to produce a work of art.’ I write it because there is some lie that I want to expose, some fact to which I want to draw attention, and my initial concern is to get a hearing.\n-George Orwell, “Why I Write”\n\nI suppose I’m passionate about some topics, some of which are clearly in my lane (e.g. Molecular Biology, Photography), and some of which are veering for me (e.g. Economics, Finance, Business Trends). That being said, I feel a duty as a scientist to explore these ideas honestly and with every intent of uncovering truth—especially to a standard that would meet those of the scientific community or journalism community.\nAnd most practically, I sometimes need more space to discuss an idea than is allowed in a tweet or mastodon post. (And those threads never seem to fully connect, anyway.)"
  },
  {
    "objectID": "posts/2023_12_29-How_I_host_quarto_blog.html#introduction-to-self-hosted-blogging",
    "href": "posts/2023_12_29-How_I_host_quarto_blog.html#introduction-to-self-hosted-blogging",
    "title": "How I run and deploy this Quarto blog",
    "section": "Introduction to self-hosted blogging",
    "text": "Introduction to self-hosted blogging\n\nWhich is really an introduction to the publishing ecosystem\nI have chosen to set up a self-hosted blog for many reasons. Self hosting has always seemed like the platonic ideal of a technically capable individual, and so I have set out to manifest this idea as a weekend project. As I will describe below, the default state of this is not ideal, and I’ve learned a lot about git, Github, Github Actions, Rmarkdown, Quarto, YAML, and TOML along the way.\nSelf hosting doesn’t literally mean I have set up a server in my office nook or anything so physically present. Self hosting just means I’m using my own html to render the content you see on the webpage before you. But why might that be worth it?\nThe state of online publishing today is a morass, to say the least. Some problems are quotidian, such as not being able to view a blog page without being bombarded with obnoxious popovers asking to log in, subscribe on the platform, or subscribe to the newsletter by email. Worse, the economics of certain high-profile blogging platforms recruiting writers to post their content there for a six-figure salary requires such platforms, in turn, to either monetize charge other, ‘lesser’ subscribers or readers. With leadership that doesn’t recognize how the mass-dissemination of hate speech can be a threat to democracy, platforms can accrue a hate speech problem, and be financially motivated to keep it.\nSelf-hosted blogging side-steps a lot of these problems. By self-hosting, I can craft a good web experience for the reader: no ads and no obnoxious popovers. I can post content without supporting these ethically dubious platforms with more content and more users (which would then be subjected to their recommendation algorithm). Should I devote the time, I could add an RSS feed, which is reminiscent of the time when all publications (aka blogs) were easily available and sync-able and readable as you wish: kind of like how podcasts still are today. (Can we make NetNewsWire relevant again?)\nPlus, Quarto and Hugo makes for a blazing fast-loading website. How cyber-punk is that?!"
  },
  {
    "objectID": "posts/2023_12_29-How_I_host_quarto_blog.html#why-quarto",
    "href": "posts/2023_12_29-How_I_host_quarto_blog.html#why-quarto",
    "title": "How I run and deploy this Quarto blog",
    "section": "Why Quarto",
    "text": "Why Quarto\nWhy would I choose Quarto as the mechanism of munging my writing and coding into a website? Well, the question partly answers itself.\nI write tons of R markdown scripts already. R Markdown is a display wrapper language that allows for the execution of code in “chunks”. It makes for beautiful documents and reports where the code, figures/tables, and descriptions are fully self-contained for reproducible data analysis. The outputs can be useful and beautiful: as simple as a 1-page PDF, or as interactive as a Shiny web application.\nI already have my data-driven resume in R Markdown. So I have some experience manipulating the rendering code to make documents pretty and multi-output compatible (e.g. PDF, Github Markdown, html). And, in theory, these documents should be easily compatible when translated into a website / blog.\nI plan on posting lots of analysis and code, and the outputs. I have been, on occasion, posting these analyses to my github project repos, like for statistics, scRNA-seq, or bulk RNA-seq. Having a proper blog will be a great home to host all these posts together, and their future posts I can even tag them, so readers who are interested in one type can keep focused on posts of that topic.\nQuarto is the next generation of scientific publishing systems, following-up where R Markdown left off. Quarto natively renders to HTML, PDF, MS Word, ePub (all by first passing through Pandoc, one of the most widely-supported markdown system). And Quarto natively supports running Python, R, Julia, and Observable JS code, because yes, contrary to popular belief, I can code in Python. (Also, I may mess around with Observable JS in the future; sounds nice for dashboards and interactive web data explorations.)"
  },
  {
    "objectID": "posts/2023_12_29-How_I_host_quarto_blog.html#deploying-without-weirdness-the-road-less-trodden",
    "href": "posts/2023_12_29-How_I_host_quarto_blog.html#deploying-without-weirdness-the-road-less-trodden",
    "title": "How I run and deploy this Quarto blog",
    "section": "Deploying without weirdness (The road less trodden)",
    "text": "Deploying without weirdness (The road less trodden)\nBut, it turns out, Quarto’s own recommended implementation of a “Quarto Blog” involves some weird git and deploy mechanics. Quarto recommends either rendering the HTML locally and pushing it to git, using the quarto publish shell command, or setting up a GitHub action.\n\nThe “render HTML locally and push” option is not optimal, because it makes for a very large git repo with large changes for even small updates, all of which are generated programmatically from the Quarto code.\nThe quarto publish shell command creates a new branch of the repo to contain the HTML pages (still checking HTML into git), but this branch is never supposed to be merged with the main/HEAD branch. (Furthermore, it cannot be merged, because it is not descended from the main branch, and contains no copies of files in it main branch.)\nThe last option, which is Quarto’s recommended Github Action, still carries out code execution in the Action, requiring a fully copy of the R environment that solves for all possible code/projects run. I got many failures on installing reticulate to the docker image just so I could say print('Hello, world') using Python. Even more annoyingly, Rmarkdown was required to evaluate some code chunks. Both reticulate and Rmarkdown are notoriously difficult and long to install to a new environment.\n\nIan Taylor notes this in his blog post about GitHub actions. So, similarly to Ian, I added execute: freeze: auto lines to this blogs _quarto.yml so that 100% of Quarto would be pre-executed locally on my machine, and only if it changed. And those pre-rendered results are committed to git. Thus, this allows for the Github Action to be very sparse, only requiring an installation of Quarto on the shell PATH. From there, Quarto renders the HTML from the frozen quarto documents, and deploys it to Github Pages with an artifact transfer. The GitHub action takes ~ 45 seconds to deploy the page, and my locally run render takes less than 10 seconds. Nice!\n\nRolling your own\nI learned a lot from this adventure. From troubleshooting those malfunctioning Github Action deploys for so long, it really struck me that for this blog, as is so often the case in life, in the outdoors, and in data science, the road less traveled is sometimes a road more suitable. And with good documentation, it’s not too bad to implement.\n\nprint(\"Hello, world\")\n\n[1] \"Hello, world\"\n\n\n\nprint('Hello, world')\n\nHello, world"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "Bio\nPatrick invents products and procedures for manipulating DNA, RNA, and their sequence information in novel and helpful ways. He focuses on writing reproducible bioinformatic analysis pipelines that cater to users of all levels. Patrick is known for inventing the Twist Pan-cancer Reference Standards (v1 & v2), the Fragmentome Calibration Control, and the RNA Fusion Positive Control.\n\n\nInterests\nPatrick is a PhD scientist skilled in bioinformatics, biological data science, data visualization, statistical modeling, next-generation sequencing (NGS), and tool-building. Patrick has coded reproducible and rigorous pipelines for high-throughput experimental designs and genomic analyses, launched best-in-class oncology reference standards, and invented new molecular methods for DNA and microbe manipulation. Originally trained in Molecular Biology, Patrick is interested in taking his knowledge and practice of data science / bioinformatics to the next level.\n\nRésumé and CV\nView resume in browser\nResume and CV git repo\n\n\n\nEducation\nPhD in Molecular Biology | University of Colorado Anschutz Medical Campus\nB.A. in Biochemistry and Molecular Biology | Hendrix College\n\n\nExperience\nTwist Bioscience | Senior R&D Scientist | Jan. 2021 - Present\nZymergen | NGS Scientist | May 2019 - Dec. 2020\n\n\nMiscellaneous\nPatrick is an avid outdoorsman and indoorsman. Outdoor pursuits include rock climbing, skiing, trail running, and landscape photography. Indoor hobbies include table top games, cooking, baking, photographic printing / framing / design."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Frameshift",
    "section": "",
    "text": "A blog of indeterminate subject matter and publication frequency from a molecular biologist shifting into bioinformatics and data science.\nLikely topics are molecular biology, biological data science, economics, policy, California ballot measure discussion, and outdoor adventures.\n \n\n\n\n\n\n\n   \n     \n     \n       Order By\n       Default\n         \n          Title\n        \n         \n          Date - Oldest\n        \n         \n          Date - Newest\n        \n         \n          Author\n        \n     \n  \n    \n      \n      \n    \n\n\n\n\n  \n\n\n\n\nGTEX RNA-seq Liver-specific Process and TF Identification\n\n\n\n\n\n\n\ncode\n\n\nRNAseq\n\n\n\n\n\n\n\n\n\n\n\nJan 3, 2024\n\n\nPatrick Cherry\n\n\n\n\n\n\n  \n\n\n\n\nWhy you should elect a high-deductible health plan\n\n\n\n\n\n\n\nfinance\n\n\nhealthcare\n\n\n\n\n\n\n\n\n\n\n\nJan 2, 2024\n\n\nPatrick Cherry\n\n\n\n\n\n\n  \n\n\n\n\nHow I run and deploy this Quarto blog\n\n\n\n\n\n\n\nnews\n\n\ncode\n\n\ncommunity\n\n\n\n\n\n\n\n\n\n\n\nDec 29, 2023\n\n\nPatrick Cherry\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html",
    "title": "Why you should elect a high-deductible health plan",
    "section": "",
    "text": "The Misunderstood Spider of the annual enrollment process just wants to cuddle."
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#background-basics-medical-benefit-plan-definitions",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#background-basics-medical-benefit-plan-definitions",
    "title": "Why you should elect a high-deductible health plan",
    "section": "Background: Basics medical benefit plan definitions",
    "text": "Background: Basics medical benefit plan definitions\n\nPremium: the amount you pay for your plan from your paycheck\nDeductible: a fixed amount that you must pay out-of-pocket before your plan begins paying for expenses\nCo-pay/co-insurance: a flat (percentage) rate that you pay for each medical event\nOut-of-pocket maximum: an upper bound on what you pay from your personal accounts in a given plan year; after this is hit, plan will cover everything at 100% (no co-pay/co-insurance)\nMedical Spending Account: account for pre-tax money diverted from your paycheck to be used for qualifying medical expenses:\n\nFlexible Spending Account (FSA): traditional “use it or lose it” annual account for PPOs\nHealth Savings Account (HSA): only available to high-deductible plan participants"
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#so-why-are-we-instinctively-afraid-of-high-deductible-plans",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#so-why-are-we-instinctively-afraid-of-high-deductible-plans",
    "title": "Why you should elect a high-deductible health plan",
    "section": "So why are we instinctively afraid of high-deductible plans?",
    "text": "So why are we instinctively afraid of high-deductible plans?\nOver the years, we’ve been conditioned to think about healthcare in certain ways. For example, we think that Premiums work like: “you pay more for more doctor options”, or “deductible: smaller is better”. But we lose sight of our sunk costs, like premiums and taxes. FSA example: if you put $1,000 in an FSA, and lose $200 because you can’t spend it, that feels terrible and you are likely to put in less next year, because you’ve lost sight of what would have happened if that money were taxed— if your tax bracket is 30%, you are still $100 ahead!\nWe also tend to think in annual cycles for health care. But if there were the ability save or ‘carry over’ unspent dollars from year to year, that situation would open up to budgeting healthcare over multiple years. And one thing actuaries know about budgeting for unpredictable events with a high spread of potential costs: averaging over time makes the ending outcome more predictable. (See the central limit theorem).\nWhat we haven’t been conditioned to think about is: premiums as a function of deductibles; costs summed / averaged over multiple years; tax & retirement benefits of healthcare budgeting."
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#the-case-for-hgih-deductible-health-plans-the-health-savings-account-hsa",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#the-case-for-hgih-deductible-health-plans-the-health-savings-account-hsa",
    "title": "Why you should elect a high-deductible health plan",
    "section": "The case for hgih-deductible health plans: the health savings account (HSA)",
    "text": "The case for hgih-deductible health plans: the health savings account (HSA)\n\nThe high deductible sounds scary, but it’s covered by the combination of your employer’s contribution to your HSA and the money you save on monthly premiums. You are paying it with “house money,” and if you don’t spend all of that, you keep it.\nThe HSA is the very best supplemental retirement savings vehicle there is; in some ways, it’s even better than your 401K, which every financial planner tells you is the first thing you should max out.\nThe upper bound (out-of-pocket max) on HDHPs means the scenarios in which you could end up paying more than you would on a PPO or EPO/HMO are probably pretty narrow even in a single year, and across multiple years the risk is very low.\nHDHP plans are generally the same plan network as that insurer’s PPO or EPO/HMO. Everything about it is the same, except for how you pay for it. Your doctor doesn’t care. Switch, switch back, no issue."
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#but-what-if-i-have-an-expensive-year",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#but-what-if-i-have-an-expensive-year",
    "title": "Why you should elect a high-deductible health plan",
    "section": "But what if I have an expensive year?",
    "text": "But what if I have an expensive year?\nMy 2020, among other ongoing medical events:  \nYou can have a bad year, but it won’t be as bad as it may seem at first: - $28k billed - $12k allowed by insurance - $3.5k is what I had to pay"
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#an-example-2023-comparative-cost-model",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#an-example-2023-comparative-cost-model",
    "title": "Why you should elect a high-deductible health plan",
    "section": "An example 2023 comparative cost model",
    "text": "An example 2023 comparative cost model\nThese numbers are purely hypothetical and in no way related to my or any specific employer.\n\nMake cost model data frame\n\nppo_deductible &lt;- 250\nppo_oop_max &lt;- 2250\nppo_employer_contributes &lt;- 0\nppo_premium &lt;- 0\nppo_co_insurance &lt;- .9\n\nhdhp_deductible &lt;- 1600\nhdhp_oop_max &lt;- 3500\nhdhp_employer_contributes &lt;- -3850\nhdhp_premium &lt;- 0\nhdhp_co_insurance &lt;- .9\n\nhealth_spending_model &lt;- function(raw_expenditure, deductible, co_insurance, oop_max, emp_contribution, premium){\n  \n  actual_expenditure &lt;- if_else(\n    raw_expenditure &lt;= deductible, raw_expenditure, if_else(\n      (deductible + ((raw_expenditure - deductible) * co_insurance) ) &gt;= oop_max, oop_max,\n        (deductible + ((raw_expenditure - deductible) * co_insurance) )\n      )\n    )  + emp_contribution + premium\n  \n  return(actual_expenditure)\n}\n\ncostsdf &lt;- seq(0, 10000, 50) %&gt;%\n  as_tibble() %&gt;%\n  rename(\"raw_expenditure\" = 1) %&gt;%\n  mutate(\"PPO\" = health_spending_model(raw_expenditure, ppo_deductible, ppo_co_insurance, ppo_oop_max,\n                                       ppo_employer_contributes, ppo_premium),\n         \"HDHP\" = health_spending_model(raw_expenditure, hdhp_deductible, hdhp_co_insurance, hdhp_oop_max,\n                                       hdhp_employer_contributes, hdhp_premium)) %&gt;%\n  pivot_longer(cols = c(\"PPO\", \"HDHP\"), values_to = \"your_cost\", names_to = \"plan_type\")\n\n\n\nPlot cost model\n\ncostsdf %&gt;%\n  ggplot(aes(x = raw_expenditure, y = your_cost, color = plan_type)) +\n  geom_line() +\n  scale_color_viridis_d(option = \"D\", begin = 0.3, end = 0.75) +\n  geom_hline(yintercept = 0, linetype = \"dotdash\", color = \"red\") +\n  scale_x_continuous(label = scales::label_currency()) +\n  scale_y_continuous(label = scales::label_currency()) +\n  labs(title = \"Plot of personal cost versus raw allowed health expenditure\",\n       x = \"Raw allowed healthcare expenditure ($)\",\n       y = \"Your cost ($)\",\n       color = \"Plan type\")\n\n\n\n\nAssumes 100% in-network providers, co-insurances are 90% of total accepted expenditure.\nThe HDHP is actually less expensive than PPO until &gt;$11,000 of raw expense. Because both plans have 90% co-insurance1, the amount paid by each is similar when under the OOP Max.\nHDHP costs 11.1% more than PPO until reaching the deductible.\nBecause the OOP Max for the HDHP is lower than the HSA contribution (from the employer), there is no medical expense scenario when this model keeps less than $350 at the end of the year."
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#the-hsa-a-very-different-medical-spending-account",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#the-hsa-a-very-different-medical-spending-account",
    "title": "Why you should elect a high-deductible health plan",
    "section": "The HSA: a very different medical spending account",
    "text": "The HSA: a very different medical spending account\n\n“From a tax standpoint, an HSA is the best thing out there because it has a triple tax advantage,” Fronstin says. “The money goes in tax free, it builds up tax free and it comes out tax free” if withdrawn for qualified medical expenses.\nNYT The Triple Tax Break You May Be Missing: A Health Savings Account\n\nCA, NJ, and AL tax HSA contributions; NH and TN tax earnings.\n\nNo “use it or lose it”— it’s your money.\nTreated like a 401K account: pre-tax1, interest-earning, investable.\nNot tied to your employer: your HSA goes with you, can be rolled over into another HSA (like 401K)\n\n$4,150 individual contribution limit; $8,300 contribution family limit (2024 IRS limits)\nEmployer may contribute some or most of that, as a benefit\nIf 55 or over, extra $1,000/year “catch-up”\n\nInterest/investment growth is tax-free.\n\nCA, NJ, and AL tax HSA contributions; NH and TN tax earnings.\n\nAt retirement age, can withdraw and use for any reason, but taxed as income (like IRA).\nIf used for qualifying medical expenses, neither the principal nor the growth is ever taxed!1"
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#multi-year-thinking",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#multi-year-thinking",
    "title": "Why you should elect a high-deductible health plan",
    "section": "Multi-Year Thinking",
    "text": "Multi-Year Thinking\nWe’ve been taught to think in annual cycles, and to over-value downside risk. Think about the upside benefit of a light year: one year in which I spend only half of my premium savings + employer contribution “stake” can cover the downside risk of years when I spend more. PPO premiums are sunk costs—you’ll never see that money again.\nMultiply your contribution (not your employer’s contribution) by your tax bracket—that’s free money. Your employer’s contribution is free money.\n1CA, NJ, and AL tax HSA contributions; NH and TN tax earnings. IRS Publication 969\nIf you meet your deductible in 2024, pack all your annual checkups into the end of 2024 and the beginning of 2026, and look to have a light year in 2025.\nBanking your receipts: you can claim your HSA reimbursements at any time, so you can “bank up” your reimbursable expenses across years, allowing your money to grow tax-free in the HSA, but leaving you the option to reimburse yourself tax-free for multiple years worth of expenses at any time.\nIRS Publication 969"
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#qualifying-to-contribute-to-an-hsa",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#qualifying-to-contribute-to-an-hsa",
    "title": "Why you should elect a high-deductible health plan",
    "section": "Qualifying to contribute to an HSA",
    "text": "Qualifying to contribute to an HSA\n\nRequirements\n\nYou are enrolled in a high-deductible health insurance plan.\n\nIRS Publication 969\n\n\nDisqualifications\n\nYou must NOT be covered by a disqualifying health plan (like another plan) (except for dental, vision, and other specific exceptions).\nYou must NOT be enrolled in medicare.\nYou must NOT be claimed as a dependent on someone else’s tax filing."
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#the-fine-print-things-to-watch-out-for",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#the-fine-print-things-to-watch-out-for",
    "title": "Why you should elect a high-deductible health plan",
    "section": "The fine print: things to watch out for",
    "text": "The fine print: things to watch out for\n\nYou are responsible for record-keeping—IRS can audit, so you need records for at least 3 years, probably 6\n\ntaxes + 20% penalty due for any money withdrawn that you can’t prove was “qualified”\ncount years from when you withdrew from the HSA, not when the medical expense happened\n\nThe State of California (among others) taxes contributions, interest, and capital gains of HSAs. (Employers document this on W-2; state vs. federal taxable incomes will be different.)\nHSA contributions are taxable to California residents; use Schedule CA (540) “other earned income.”\nYou will need to file an extra schedule with your taxes (IRS form 8889).\nYou will become a savvier medical consumer—it’s your money! Watch for mis-billing, look at service costs up front.\nDon’t underestimate the possibility you will end up going out-of-network when you do your calculations.\nIf you invest your HSA money in index funds, it may grow faster, but not be FDIC-insured."
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#in-summary-what-have-we-learned",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#in-summary-what-have-we-learned",
    "title": "Why you should elect a high-deductible health plan",
    "section": "In summary: what have we learned?",
    "text": "In summary: what have we learned?\nPlaying with house money: with your employer’s contribution, your premium savings, and the money you would have put in an FSA, you’re already better than break-even on the deductible; if you don’t meet your deductible in a given a year, you get that benefit instead of the insurance company.\nThink multi-year when assessing risk: it’s possible you might pay a little more in a really expensive year, but you will pay a lot less in a good year; across years, it’s hard to lose.\nHSAs are awesome: max out your contribution of pre-tax money to the HSA and get even better tax advantages than your 401(k); avoid taxes on it completely if you continue to use it for medical expenses after you retire."
  },
  {
    "objectID": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#resources-further-reading",
    "href": "posts/2024_01_02-why_you_should_elect_a_HDHP.html#resources-further-reading",
    "title": "Why you should elect a high-deductible health plan",
    "section": "Resources & Further Reading",
    "text": "Resources & Further Reading\n\nIRS Publication 969\nFidelity HSA contribution limits and eligibility rules\nInstructions for California Franchise Tax Board Schedule CA (540)\nBogleheads Health Savings Account"
  }
]